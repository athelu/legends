# D8 TTRPG Compendium Packs - Developer Guide

## Pack Structure

The D8 TTRPG system includes three compendium packs with source files for version control:

```
packs/
├── backgrounds/
│   └── _source/
│       └── backgrounds.json    # All 50 backgrounds
├── ancestries/
│   └── _source/
│       └── (to be added)
└── feats/
    └── _source/
        └── (to be added)
```

## Foundry v13+ Compendium Workflow

### Understanding Foundry Packs

In Foundry v13+, compendium packs are stored as `.db` files (LevelDB format). The workflow is:

1. **Source Files** (`_source/`) - JSON files for version control
2. **Compiled Packs** (`.db` files) - Generated by Foundry

### Initial Setup (For Development)

**Option 1: Let Foundry Generate the Pack**

1. Install the system in Foundry
2. Open the Backgrounds compendium
3. Use the import macro (see IMPORTING_BACKGROUNDS.md)
4. Foundry automatically creates the `.db` files

**Option 2: Use fvtt-cli (Advanced)**

```bash
# Install fvtt-cli
npm install -g @foundryvtt/fvtt-cli

# Configure Foundry path
fvtt configure set dataPath "/path/to/FoundryVTT/Data"

# Package the compendium
fvtt package workon d8-ttrpg
fvtt package pack backgrounds --in packs/backgrounds/_source/backgrounds.json
```

### Updating Content

When you want to add or modify backgrounds:

1. **Edit the source JSON** in `packs/backgrounds/_source/backgrounds.json`
2. **In Foundry**, you have two options:
   - **Manual**: Delete and re-import using the macro
   - **With fvtt-cli**: Run `fvtt package pack backgrounds`

### Extracting from Foundry

If you've edited backgrounds in Foundry UI and want to save them:

```bash
# Extract pack to source JSON
fvtt package unpack backgrounds --out packs/backgrounds/_source/
```

This extracts the `.db` content back to JSON for version control.

## GitHub Workflow

### What to Commit

**DO commit:**
- ✅ `packs/backgrounds/_source/` - Source JSON files
- ✅ `system.json` - Pack definitions
- ✅ Documentation files

**DON'T commit:**
- ❌ `packs/backgrounds/*.db` - Generated files (too large, binary)
- ❌ `packs/backgrounds/*.log` - Foundry logs

### .gitignore

Add to `.gitignore`:
```
# Foundry compiled packs
packs/**/*.db
packs/**/*.log

# Keep source files
!packs/**/_source/
```

## For End Users (Non-Developers)

End users don't need to worry about any of this! When they install your system:

1. Foundry sees the pack definitions in `system.json`
2. If `.db` files don't exist, Foundry creates empty packs
3. Users import content using the macro or manual method
4. OR you can pre-build the `.db` files and include them in releases

## Pre-Building Packs for Release

To distribute a system with pre-populated compendiums:

1. Set up Foundry locally
2. Import all backgrounds using the macro
3. Foundry generates the `.db` files
4. Include those `.db` files in your release tarball
5. Users get fully populated compendiums immediately!

### Release Build Script

```bash
#!/bin/bash
# build-release.sh

# Make sure you have fvtt-cli installed and configured
fvtt package workon d8-ttrpg

# Pack all compendiums from source
fvtt package pack backgrounds --in packs/backgrounds/_source/backgrounds.json
fvtt package pack ancestries --in packs/ancestries/_source/ancestries.json
fvtt package pack feats --in packs/feats/_source/feats.json

# Create release tarball with compiled packs
tar -czf d8-ttrpg-system-v0.5.0.tar.gz \
    --exclude='.*' \
    --exclude='node_modules' \
    d8-system/

echo "Release built with pre-populated compendiums!"
```

## Manual Pack Building (No fvtt-cli)

If you don't want to use fvtt-cli:

1. **Install system in Foundry**
2. **Run the import macro** (see IMPORTING_BACKGROUNDS.md)
3. **Copy the generated .db files**:
   - From: `[Foundry Data]/Data/systems/d8-ttrpg/packs/backgrounds/`
   - To: Your git repo's `packs/backgrounds/`
4. **Commit the .db files** for this release
5. **Users get pre-populated packs** when they install

## Current Status

- ✅ Backgrounds: 50 items in `_source/backgrounds.json`
- ⏳ Ancestries: Not yet populated
- ⏳ Feats: Not yet populated

## Recommended Workflow

**For active development:**
1. Keep source JSON in `_source/` folders
2. Use fvtt-cli to pack/unpack
3. Don't commit `.db` files to git

**For releases:**
1. Build `.db` files before release
2. Include them in release tarballs
3. Users get instant content!

This gives you both version control flexibility AND end-user convenience.
