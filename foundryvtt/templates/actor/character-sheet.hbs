<form class="{{cssClass}} flexcol" autocomplete="off">
  
  {{!-- Header --}}
  <header class="sheet-header">
    <div class="header-info">
      <div class="info-line">
        <label>Name:</label>
        <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/>
      </div>
      <div class="info-line">
        <label>Background:</label>
        <input type="text" name="system.biography.background" value="{{system.biography.background}}" placeholder="Background"/>
      </div>
      <div class="info-line">
        <label>Race:</label>
        <input type="text" name="system.biography.ancestry" value="{{system.biography.ancestry}}" placeholder="Ancestry"/>
      </div>
      <div class="info-line">
        <label>Tier:</label>
        <span class="tier-display">{{tier.current}}</span>
        <label class="xp-label">Total XP:</label>
        <input type="number" name="system.tier.xp" value="{{tier.xp}}" data-dtype="Number" class="xp-input"/>
        <label class="xp-label">Unspent XP:</label>
        <input type="number" name="system.tier.unspent" value="0" data-dtype="Number" class="xp-input"/>
      </div>
    </div>
  </header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="main">Main</a>
    <a class="item" data-tab="weapons">Weapons</a>
    <a class="item" data-tab="actions">Actions</a>
    {{#if system.energy}}
    <a class="item" data-tab="magic">Magic</a>
    {{/if}}
    <a class="item" data-tab="features">Features</a>
    <a class="item" data-tab="equipment">Equipment</a>
    <a class="item" data-tab="biography">Biography</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    
    {{!-- Main Tab --}}
    <div class="tab main" data-group="primary" data-tab="main">
      <div class="main-layout">
        {{!-- Left Column: Skills --}}
        <div class="skills-column">
          <h3>Skills</h3>
          <div class="skills-list">
            {{#each skillList}}
            <div class="skill-row" data-skill="{{key}}">
              <label class="skill-name">{{label}}</label>
              <span class="skill-attr">&lt;{{attr}}&gt;</span>
              <input type="number" name="system.skills.{{key}}" value="{{value}}" data-dtype="Number" class="skill-rank"/>
              <button type="button" class="skill-roll rollable" data-skill="{{key}}" title="Roll {{label}}">
                <i class="fas fa-dice-d8"></i>
              </button>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- Right Column: Attributes & Resources --}}
        <div class="stats-column">
          <h3>Attributes</h3>
          <div class="attributes-list">
            {{#each system.attributes as |attr key|}}
            <div class="attribute-row" data-attribute="{{key}}">
              <label>{{attr.label}}</label>
              <input type="number" name="system.attributes.{{key}}.value" value="{{attr.value}}" data-dtype="Number" class="attribute-value"/>
            </div>
            {{/each}}
          </div>

          <h3>Resources</h3>
          <div class="resources-section">
            {{!-- HP --}}
            <div class="resource-row hp-row">
              <label>HP</label>
              <input type="number" name="system.hp.value" value="{{system.hp.value}}" data-dtype="Number" class="resource-current"/>
              <span class="sep">/</span>
              <span class="resource-max">{{system.hp.max}}</span>
              <span class="temp-hp-display">
                {{#if system.hp.temp}}
                  +{{system.hp.temp}} temp
                {{/if}}
              </span>
            </div>

            {{!-- Luck --}}
            <div class="resource-row luck-row">
              <label>Luck</label>
              <input type="number" name="system.luck.current" value="{{system.luck.current}}" data-dtype="Number" class="resource-current"/>
              <span class="sep">/</span>
              <span class="resource-max">{{system.luck.max}}</span>
            </div>

            {{!-- Energy (if caster) --}}
            {{#if system.energy}}
            <div class="resource-row energy-row">
              <label>Energy</label>
              <input type="number" name="system.energy.value" value="{{system.energy.value}}" data-dtype="Number" class="resource-current"/>
              <span class="sep">/</span>
              <span class="resource-max">{{system.energy.max}}</span>
            </div>
            {{/if}}

            {{!-- DR --}}
            <div class="resource-row dr-row">
              <label>DR</label>
              <span class="dr-value">{{system.dr.total}}</span>
            </div>
          </div>

          {{!-- Rest Buttons --}}
          <div class="rest-buttons">
            <button type="button" class="short-rest-button" title="Short Rest (10 minutes): Regain Con HP + 1 Luck">
              <i class="fas fa-moon"></i> Short Rest
            </button>
            <button type="button" class="long-rest-button" title="Long Rest (8 hours): Regain (Con Ã— 4) HP, restore all Luck & Energy">
              <i class="fas fa-bed"></i> Long Rest
            </button>
          </div>
        </div>
      </div>
    </div>

    {{!-- Weapons Tab --}}
    <div class="tab weapons" data-group="primary" data-tab="weapons">
      <div class="inventory-header">
        <h3>Weapons</h3>
        <button type="button" class="open-compendium" data-type="weapon" title="Add from Compendium">
          <i class="fas fa-atlas"></i> Add Weapon
        </button>
      </div>
      <ol class="items-list weapon-list">
        <li class="items-header flexrow">
          <div class="item-name">Name</div>
          <div class="item-detail">Attack</div>
          <div class="item-detail">Damage</div>
          <div class="item-controls"></div>
        </li>
        {{#each weapons as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-detail">
            <button type="button" class="item-roll" title="Attack">
              <i class="fas fa-dice-d8"></i>
            </button>
          </div>
          <div class="item-detail">{{item.system.damage.dice}}</div>
          <div class="item-controls">
            <a class="item-control item-equip {{#if item.system.equipped}}equipped{{/if}}" title="{{#if item.system.equipped}}Equipped{{else}}Not Equipped{{/if}}">
              <i class="fas fa-hand-fist"></i>
            </a>
            <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    {{!-- Actions Tab --}}
    <div class="tab actions" data-group="primary" data-tab="actions">
      <div class="inventory-header">
        <h3>Actions & Abilities</h3>
        <button type="button" class="open-compendium" data-type="action" title="Add from Compendium">
          <i class="fas fa-atlas"></i> Add Action
        </button>
      </div>
      <ol class="items-list action-list">
        <li class="items-header flexrow">
          <div class="item-name">Name</div>
          <div class="item-detail">Cost</div>
          <div class="item-controls"></div>
        </li>
        {{#each actions as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-detail action-cost">
            {{#if item.system.cost.actions}}{{item.system.cost.actions}} <i class="fas fa-running"></i>{{/if}}
            {{#if item.system.cost.energy}}{{item.system.cost.energy}} <i class="fas fa-bolt"></i>{{/if}}
            {{#if item.system.cost.luck}}{{item.system.cost.luck}} <i class="fas fa-clover"></i>{{/if}}
          </div>
          <div class="item-controls">
            <a class="item-control item-chat" title="Post to Chat"><i class="fas fa-comment"></i></a>
            <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    {{!-- Magic Tab --}}
    {{#if system.energy}}
    <div class="tab magic" data-group="primary" data-tab="magic">
      <div class="inventory-header">
        <h3>Weaves</h3>
        <button type="button" class="open-compendium" data-type="weave" title="Add from Compendium">
          <i class="fas fa-atlas"></i> Add Weave
        </button>
      </div>
      
      {{!-- Weave Energies --}}
      <div class="weave-energies">
        <h4>Weaving Proficiencies</h4>
        <div class="energy-grid">
          {{#each system.energies as |energy key|}}
          <div class="energy-item" data-energy="{{key}}">
            <label>{{energy.label}}</label>
            <input type="number" name="system.energies.{{key}}.value" value="{{energy.value}}" data-dtype="Number" min="0" max="10"/>
          </div>
          {{/each}}
        </div>
      </div>

      {{!-- Weaves List --}}
      <ol class="items-list weave-list">
        <li class="items-header flexrow">
          <div class="item-name">Name</div>
          <div class="item-detail">Energy</div>
          <div class="item-detail">Cost</div>
          <div class="item-controls"></div>
        </li>
        {{#each weaves as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-detail">{{item.system.energy}}</div>
          <div class="item-detail">{{item.system.energyCost}}</div>
          <div class="item-controls">
            <a class="item-control item-roll" title="Cast Weave"><i class="fas fa-dice-d8"></i></a>
            <a class="item-control item-chat" title="Post to Chat"><i class="fas fa-comment"></i></a>
            <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>
    {{/if}}

    {{!-- Features Tab --}}
    <div class="tab features" data-group="primary" data-tab="features">
      <div class="features-layout">
        {{!-- Feats --}}
        <div class="feature-section">
          <div class="inventory-header">
            <h3>Feats</h3>
            <button type="button" class="open-compendium" data-type="feat" title="Add from Compendium">
              <i class="fas fa-atlas"></i> Add Feat
            </button>
          </div>
          <ol class="items-list feat-list">
            {{#each feats as |item id|}}
            <li class="item flexrow" data-item-id="{{item._id}}">
              <div class="item-image">
                <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
              </div>
              <h4 class="item-name">{{item.name}}</h4>
              <div class="item-controls">
                <a class="item-control item-view" title="View"><i class="fas fa-eye"></i></a>
                <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </div>
            </li>
            {{/each}}
          </ol>
        </div>

        {{!-- Traits --}}
        <div class="feature-section">
          <div class="inventory-header">
            <h3>Traits</h3>
            <button type="button" class="open-compendium" data-type="trait" title="Add from Compendium">
              <i class="fas fa-atlas"></i> Add Trait
            </button>
          </div>
          <ol class="items-list trait-list">
            {{#each traits as |item id|}}
            <li class="item flexrow" data-item-id="{{item._id}}">
              <div class="item-image">
                <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
              </div>
              <h4 class="item-name">{{item.name}}</h4>
              <div class="item-controls">
                <a class="item-control item-view" title="View"><i class="fas fa-eye"></i></a>
                <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </div>
            </li>
            {{/each}}
          </ol>
        </div>

        {{!-- Flaws --}}
        <div class="feature-section">
          <div class="inventory-header">
            <h3>Flaws</h3>
            <button type="button" class="open-compendium" data-type="flaw" title="Add from Compendium">
              <i class="fas fa-atlas"></i> Add Flaw
            </button>
          </div>
          <ol class="items-list flaw-list">
            {{#each flaws as |item id|}}
            <li class="item flexrow" data-item-id="{{item._id}}">
              <div class="item-image">
                <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
              </div>
              <h4 class="item-name">{{item.name}}</h4>
              <div class="item-controls">
                <a class="item-control item-view" title="View"><i class="fas fa-eye"></i></a>
                <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
                <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
              </div>
            </li>
            {{/each}}
          </ol>
        </div>
      </div>
    </div>

    {{!-- Equipment Tab --}}
    <div class="tab equipment" data-group="primary" data-tab="equipment">
      {{!-- Armor Section --}}
      <div class="inventory-header">
        <h3>Armor</h3>
        <button type="button" class="open-compendium" data-type="armor" title="Add from Compendium">
          <i class="fas fa-atlas"></i> Add Armor
        </button>
      </div>
      <ol class="items-list armor-list">
        <li class="items-header flexrow">
          <div class="item-name">Name</div>
          <div class="item-detail">DR</div>
          <div class="item-detail">Penalty</div>
          <div class="item-controls"></div>
        </li>
        {{#each armor as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-detail">{{item.system.dr}}</div>
          <div class="item-detail">{{item.system.stealthPenalty}}</div>
          <div class="item-controls">
            <a class="item-control item-equip {{#if item.system.equipped}}equipped{{/if}}" title="{{#if item.system.equipped}}Equipped{{else}}Not Equipped{{/if}}">
              <i class="fas fa-shield-alt"></i>
            </a>
            <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>

      {{!-- Other Equipment Section --}}
      <div class="inventory-header">
        <h3>Equipment</h3>
        <button type="button" class="open-compendium" data-type="equipment" title="Add from Compendium">
          <i class="fas fa-atlas"></i> Add Equipment
        </button>
      </div>
      <ol class="items-list equipment-list">
        <li class="items-header flexrow">
          <div class="item-name">Name</div>
          <div class="item-detail">Qty</div>
          <div class="item-controls"></div>
        </li>
        {{#each equipment as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-detail">
            <input type="number" name="items.{{item._id}}.system.quantity" value="{{item.system.quantity}}" data-dtype="Number" min="0"/>
          </div>
          <div class="item-controls">
            <a class="item-control item-chat" title="Post to Chat"><i class="fas fa-comment"></i></a>
            <a class="item-control item-edit" title="Edit"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    {{!-- Biography Tab --}}
    <div class="tab biography" data-group="primary" data-tab="biography">
      {{editor enrichedBiography target="system.biography.value" button=true owner=owner editable=editable}}
    </div>
  </section>
</form>
