<form class="{{cssClass}} flexcol" autocomplete="off">
  
  {{!-- Header --}}
  <header class="sheet-header">
    <div class="header-info">
      <div class="info-line">
        <label>Name:</label>
        <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/>
      </div>
      <div class="info-line">
        <label>Background:</label>
        <input type="text" name="system.biography.background" value="{{system.biography.background}}" placeholder="Background"/>
      </div>
      <div class="info-line">
        <label>Race:</label>
        <input type="text" name="system.biography.ancestry" value="{{system.biography.ancestry}}" placeholder="Ancestry"/>
      </div>
      <div class="info-line">
        <label>Tier:</label>
        <span class="tier-display">{{tier.current}}</span>
        <label class="xp-label">Total XP:</label>
        <input type="number" name="system.tier.xp" value="{{tier.xp}}" data-dtype="Number" class="xp-input"/>
        <label class="xp-label">Unspent XP:</label>
        <input type="number" name="system.tier.unspent" value="0" data-dtype="Number" class="xp-input"/>
      </div>
    </div>
  </header>

  {{!-- Sheet Tab Navigation --}}
  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="main">Main</a>
    <a class="item" data-tab="combat">Combat</a>
    {{#if system.energy}}
    <a class="item" data-tab="magic">Magic</a>
    {{/if}}
    <a class="item" data-tab="features">Features</a>
    <a class="item" data-tab="equipment">Equipment</a>
    <a class="item" data-tab="biography">Biography</a>
  </nav>

  {{!-- Sheet Body --}}
  <section class="sheet-body">
    
    {{!-- Main Tab --}}
    <div class="tab main" data-group="primary" data-tab="main">
      <div class="main-layout">
        {{!-- Left Column: Skills --}}
        <div class="skills-column">
          <h3>Skills</h3>
          <div class="skills-list">
            {{#each skillList}}
            <div class="skill-row" data-skill="{{key}}">
              <label class="skill-name">{{label}}</label>
              <span class="skill-attr">&lt;{{attr}}&gt;</span>
              <input type="number" name="system.skills.{{key}}.value" value="{{value}}" data-dtype="Number" class="skill-rank"/>
              <button type="button" class="skill-roll rollable" data-skill="{{key}}" title="Roll {{label}}">
                <i class="fas fa-dice-d8"></i>
              </button>
            </div>
            {{/each}}
          </div>
        </div>

        {{!-- Right Column: Attributes & Resources --}}
        <div class="stats-column">
          <h3>Attributes</h3>
          <div class="attributes-list">
            {{#each system.attributes as |attr key|}}
            <div class="attribute-row" data-attribute="{{key}}">
              <label>{{attr.label}}</label>
              <input type="number" name="system.attributes.{{key}}.value" value="{{attr.value}}" data-dtype="Number" />
            </div>
            {{/each}}
          </div>

          <h3>Resources</h3>
          <div class="resources">
            <div class="resource-row">
              <label>Hit Points</label>
              <div class="resource-values">
                <input type="number" name="system.hp.value" value="{{system.hp.value}}" data-dtype="Number" class="resource-input"/>
                <span class="resource-sep">/</span>
                <span class="resource-max">{{system.hp.max}}</span>
              </div>
            </div>
            
            <div class="resource-row">
              <label>Luck</label>
              <div class="resource-values">
                <input type="number" name="system.luck.current" value="{{system.luck.current}}" data-dtype="Number" class="resource-input"/>
                <span class="resource-sep">/</span>
                <span class="resource-max">{{system.luck.max}}</span>
              </div>
            </div>
            
            <div class="resource-row">
              <label>Damage Reduction</label>
              <span class="dr-value">{{system.dr.value}}</span>
            </div>
          </div>

          <h3>Saving Throws</h3>
          <div class="saves-grid">
            <div class="save-item">
              <button type="button" class="save-roll" data-save="fortitude" title="Roll Fortitude Save">
                <i class="fas fa-shield-alt"></i> Fortitude
              </button>
              <span class="save-formula">(Con + Luck)</span>
            </div>
            <div class="save-item">
              <button type="button" class="save-roll" data-save="reflex" title="Roll Reflex Save">
                <i class="fas fa-running"></i> Reflex
              </button>
              <span class="save-formula">(Agi + Luck)</span>
            </div>
            <div class="save-item">
              <button type="button" class="save-roll" data-save="will" title="Roll Willpower Save">
                <i class="fas fa-brain"></i> Willpower
              </button>
              <span class="save-formula">(Wis + Luck)</span>
            </div>
          </div>

          <div class="rest-buttons">
            <button type="button" class="short-rest">
              <i class="fas fa-hourglass-half"></i> Short Rest
            </button>
            <button type="button" class="long-rest">
              <i class="fas fa-bed"></i> Long Rest
            </button>
          </div>
        </div>
      </div>
    </div>

    {{!-- Combat Tab --}}
    <div class="tab combat" data-group="primary" data-tab="combat">
      <h3>Weapons</h3>
      <ol class="items-list weapons-list">
        <li class="item flexrow items-header">
          <div class="item-name">Weapon</div>
          <div class="item-damage">Damage</div>
          <div class="item-controls"></div>
        </li>
        {{#each weapons as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-damage">{{item.system.damage.base}} {{item.system.damage.type}}</div>
          <div class="item-controls">
            <a class="item-control item-equip" title="{{#if item.system.equipped}}Equipped{{else}}Not Equipped{{/if}}">
              <i class="{{#if item.system.equipped}}fas{{else}}far{{/if}} fa-circle"></i>
            </a>
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="weapon">
          <i class="fas fa-book"></i> Browse Weapons
        </button>
      </div>
      
      <h3>Armor</h3>
      <ol class="items-list armor-list">
        {{#each armor as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-dr">DR {{item.system.dr.value}}</div>
          <div class="item-controls">
            <a class="item-control item-equip" title="{{#if item.system.equipped}}Equipped{{else}}Not Equipped{{/if}}">
              <i class="{{#if item.system.equipped}}fas{{else}}far{{/if}} fa-circle"></i>
            </a>
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="armor">
          <i class="fas fa-book"></i> Browse Armor
        </button>
      </div>
    </div>

    {{!-- Magic Tab --}}
    {{#if system.energy}}
    <div class="tab magic" data-group="primary" data-tab="magic">
      <div class="magic-header">
        <div class="energy-info">
          <label>Max Energy:</label>
          <span class="energy-value">{{system.energy.max}}</span>
        </div>
        <div class="energy-info">
          <label>Current Energy:</label>
          <input type="number" name="system.energy.value" value="{{system.energy.value}}" data-dtype="Number"/>
        </div>
      </div>
      
      <h3>Potentials</h3>
      <div class="energies-grid">
        {{#each system.potentials as |potential key|}}
        <div class="energy-row">
          <label>{{potential.label}}</label>
          <input type="number" name="system.potentials.{{key}}.value" value="{{potential.value}}" data-dtype="Number" />
        </div>
        {{/each}}
      </div>
      
      <h3>Mastery</h3>
      <div class="energies-grid">
        {{#each system.mastery as |mastery key|}}
        <div class="energy-row">
          <label>{{mastery.label}}</label>
          <input type="number" name="system.mastery.{{key}}.value" value="{{mastery.value}}" data-dtype="Number" />
        </div>
        {{/each}}
      </div>
      
      <h3>Weaves</h3>
      <ol class="items-list weaves-list">
        {{#each weaves as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-cost">{{item.system.totalEnergyCost}} Energy</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="weave">
          <i class="fas fa-book"></i> Browse Weaves
        </button>
      </div>
    </div>
    {{/if}}

    {{!-- Features Tab --}}
    <div class="tab features" data-group="primary" data-tab="features">
      <h3>Feats</h3>
      <ol class="items-list feats-list">
        {{#each feats as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="feat">
          <i class="fas fa-book"></i> Browse Feats
        </button>
      </div>
      
      <h3>Traits</h3>
      <ol class="items-list traits-list">
        {{#each traits as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="trait">
          <i class="fas fa-book"></i> Browse Traits
        </button>
      </div>
      
      <h3>Flaws</h3>
      <ol class="items-list flaws-list">
        {{#each flaws as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="flaw">
          <i class="fas fa-book"></i> Browse Flaws
        </button>
      </div>
    </div>

    {{!-- Equipment Tab --}}
    <div class="tab equipment" data-group="primary" data-tab="equipment">
      <div class="currency">
        <label>Gold Pieces</label>
        <input type="number" name="system.currency.gp" value="{{system.currency.gp}}" data-dtype="Number" />
      </div>
      
      <h3>Equipment</h3>
      <ol class="items-list equipment-list">
        {{#each equipment as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name">{{item.name}}</h4>
          <div class="item-quantity">Qty: {{item.system.quantity}}</div>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="equipment">
          <i class="fas fa-book"></i> Browse Equipment
        </button>
      </div>
    </div>

    {{!-- Biography Tab --}}
    <div class="tab biography" data-group="primary" data-tab="biography">
      
      {{!-- Background Section --}}
      <h3>Background</h3>
      <ol class="items-list background-list">
        {{#each backgrounds as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="background" {{#if backgrounds.length}}disabled{{/if}}>
          <i class="fas fa-book"></i> Browse Backgrounds
        </button>
      </div>
      
      {{!-- Ancestry Section --}}
      <h3>Ancestry</h3>
      <ol class="items-list ancestry-list">
        {{#each ancestries as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-image rollable" data-roll-type="item">
            <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
          </div>
          <h4 class="item-name rollable" data-roll-type="item">{{item.name}}</h4>
          <div class="item-controls">
            <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      <div class="compendium-browse">
        <button type="button" class="open-compendium" data-compendium="ancestry" {{#if ancestries.length}}disabled{{/if}}>
          <i class="fas fa-book"></i> Browse Ancestries
        </button>
      </div>
      
      {{!-- Biography Text Editor --}}
      <h3>Character Biography</h3>
      <div class="editor-content">
        {{editor enrichedBiography target="system.biography.value" button=true owner=owner editable=editable}}
      </div>
    </div>

  </section>
</form>
