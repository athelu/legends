/* ========================================
   LEGENDS TTRPG SYSTEM
   Complete, Consolidated Stylesheet
   ======================================== */

/* === CSS Variables === */
:root {
  /* Primary Colors */
  --d8-primary: #4a5568;
  --d8-accent: #2d3748;
  --d8-gold: #c69963;
  
  /* Backgrounds */
  --d8-bg: #FFFFFF;
  --d8-bg-light: #F7FAFC;
  
  /* Text Colors */
  --d8-text: #2d3748;
  --d8-secondary: #718096;
  
  /* Borders */
  --d8-border: #cbd5e0;
  
  /* Utility Colors */
  --d8-danger: #f56565;
  --d8-success: #48bb78;
  --d8-info: #4299e1;
  --d8-warning: #ed8936;
}

/* ========================================
   BASE SHEET STYLES
   AppV2 applies its own chrome. We override
   to preserve the Legends look and feel.
   ======================================== */

.legends {
  font-family: "Signika", sans-serif;
  background: var(--d8-bg);
  color: var(--d8-text);
}

/* ========================================
   UNIVERSAL COLLAPSIBLE ITEM SYSTEM
   Based on PF2E best practices
   ======================================== */

/* Collapsible Item Container */
.legends .item-collapsible {
  border-bottom: 1px solid var(--d8-border);
}

.legends .item-collapsible:last-child {
  border-bottom: none;
}

/* Item Header (always visible) */
.legends .item-header {
  display: flex;
  align-items: center;
  padding: 0.5rem;
  background: transparent;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.legends .item-header:hover {
  background: rgba(0, 0, 0, 0.05);
}

.legends .item-collapsible.expanded .item-header {
  background: rgba(74, 85, 104, 0.1);
  border-bottom: 1px solid var(--d8-border);
}

/* Expand/Collapse Caret */
.legends .item-caret {
  transition: transform 0.2s ease;
  transform: rotate(0deg);
  transform-origin: center;
  margin-right: 0.5rem;
  color: var(--d8-secondary);
  cursor: pointer;
  font-size: 0.875rem;
  width: 1rem;
  text-align: center;
}

.legends .item-collapsible.expanded .item-caret {
  transform: rotate(90deg);
  transform-origin: center;
  color: var(--d8-primary);
}

/* Item Name (clickable) */
.legends .item-name-clickable {
  flex: 1;
  color: var(--d8-text);
  text-decoration: none;
  font-weight: 500;
  min-width: 0;
}

.legends .item-name-clickable:hover {
  color: var(--d8-primary);
  text-decoration: none;
}

.legends .item-collapsible.expanded .item-name-clickable {
  color: var(--d8-primary);
  font-weight: 600;
}

/* Item Summary/Details (collapsible content) */
.legends .item-summary {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
  background: rgba(247, 250, 252, 0.8);
  border-top: none;
}

.legends .item-collapsible.expanded .item-summary {
  max-height: 500px; /* Large enough for most content */
  border-top: 1px solid var(--d8-border);
}

.legends .item-summary-content {
  padding: 1rem;
  border-left: 3px solid var(--d8-primary);
  margin: 0.5rem;
  background: white;
  border-radius: 4px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* Item Summary Typography */
.legends .item-summary-content h4 {
  margin: 0 0 0.5rem 0;
  color: var(--d8-primary);
  font-size: 1rem;
  font-weight: 600;
}

.legends .item-summary-content p {
  margin: 0 0 0.75rem 0;
  line-height: 1.5;
  color: var(--d8-text);
}

.legends .item-summary-content p:last-child {
  margin-bottom: 0;
}

/* Details section wrapper */
.legends .details-section {
  width: fit-content;
  max-width: 100%;
}

/* Detail Rows in Summary */
.legends .detail-row {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  padding: 0.25rem 0;
  gap: 0.5rem;
  width: fit-content;
  max-width: 500px;
}

.legends .detail-row:last-child {
  border-bottom: none;
}

.legends .detail-label {
  font-weight: 600;
  color: var(--d8-primary);
  width: auto;
  flex: 0 0 auto;
  white-space: nowrap;
}

.legends .detail-value {
  color: var(--d8-text);
  flex: 0 0 auto;
  width: auto;
}

/* Special styling for tags/traits */
.legends .item-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.25rem;
  margin-top: 0.5rem;
}

.legends .item-tag {
  background: var(--d8-primary);
  color: white;
  padding: 0.125rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
}

/* Animation States */
.legends .item-summary {
  opacity: 0;
  transform: translateY(-10px);
}

.legends .item-collapsible.expanded .item-summary {
  opacity: 1;
  transform: translateY(0);
}

/* Loading State */
.legends .item-summary.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 60px;
  opacity: 0.6;
}

.legends .item-summary.loading::after {
  content: "âŸ³";
  font-size: 1.5rem;
  animation: spin 1s linear infinite;
  color: var(--d8-primary);
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.legends .window-content {
  background: var(--d8-bg);
  padding: 0;
  color: var(--d8-text);
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* Ensure all inputs/selects inherit dark text (override AppV2 defaults) */
.legends input,
.legends select,
.legends textarea,
.legends label,
.legends span,
.legends h3,
.legends h4 {
  color: var(--d8-text);
}

/* ========================================
   DIALOG BUTTON LAYOUT (DialogV2)
   ======================================== */

/* Fix button layout for roll dialogs - make buttons wrap properly */
.dialog .dialog-buttons,
.application .dialog-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 5px;
  justify-content: center;
}

/* Roll dialog buttons: 3 per row for attack buttons, then 2 for fortune/misfortune */
.dialog .dialog-buttons button,
.application .dialog-buttons button {
  flex: 0 0 calc(33.333% - 4px);
  min-width: 120px;
}

/* Fortune and Misfortune buttons on second row take up more space */
.dialog .dialog-buttons button:nth-child(4),
.dialog .dialog-buttons button:nth-child(5),
.application .dialog-buttons button:nth-child(4),
.application .dialog-buttons button:nth-child(5) {
  flex: 0 0 calc(50% - 3px);
}

/* Window Title Bar Fix - works for both V1 and V2 */
.legends .window-header {
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent)) !important;
}

.legends .window-title {
  color: #f0f0f0 !important;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
}

/* AppV2 window controls (close, minimize buttons) */
.legends .window-header .header-control {
  color: #f0f0f0 !important;
}

/* Tab content visibility: only active tab is shown */
.legends .sheet-body > .tab {
  display: none;
  height: 100%;
}

.legends .sheet-body > .tab.active {
  display: flex;
  flex-direction: column;
  flex: 1;
  overflow-y: auto;
  height: 100%;
}

/* ========================================
   CHARACTER SHEET HEADER
   ======================================== */

.legends.sheet.actor.character .sheet-header {
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  color: white;
  padding: 6px 10px;
  border-bottom: 2px solid var(--d8-gold);
  display: flex;
  flex-direction: row;
  gap: 10px;
  align-items: center;
  margin-bottom: 0;
}

.legends.sheet.actor.character .sheet-header .profile-img {
  border: 2px solid var(--d8-gold);
  border-radius: 4px;
  cursor: pointer;
  object-fit: cover;
  flex-shrink: 0;
}

.legends .header-info {
  display: flex;
  flex-direction: column;
  gap: 3px;
  flex: 1;
}

.legends .header-info .info-line {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
  line-height: 1.2;
}

.legends.sheet.actor.character .window-content {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Ensure main form takes full height */
.legends.sheet.actor.character form.flexcol {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.legends .header-info .info-line label {
  font-weight: bold;
  color: rgba(255, 255, 255, 0.8);
  min-width: 70px;
  font-size: 10px;
}

.legends .header-info .info-line input {
  background: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: white;
  padding: 1px 4px;
  border-radius: 3px;
  font-size: 11px;
  flex: 1;
  height: 20px;
}

.legends .header-info .info-line input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.legends .header-info .info-line .tier-display {
  font-weight: bold;
  color: white;
  padding: 1px 6px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 3px;
  min-width: 25px;
  text-align: center;
  font-size: 11px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.legends .header-info .info-line .xp-label {
  font-weight: bold;
  color: rgba(255, 255, 255, 0.8);
  font-size: 10px;
  margin-left: 8px;
}

.legends .header-info .info-line .xp-input {
  width: 50px;
  flex: none;
}

/* ========================================
   SHEET TABS
   ======================================== */

.legends .sheet-tabs {
  flex: 0 0 40px;
  border-bottom: 2px solid var(--d8-border);
  background: var(--d8-bg-light);
  margin-top: 0;
}

.legends .sheet-tabs .item {
  padding: 10px 20px;
  font-weight: bold;
  text-transform: uppercase;
  font-size: 11px;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.2s;
  border-bottom: 3px solid transparent;
  color: var(--d8-secondary);
}

.legends .sheet-tabs .item:hover {
  background: rgba(139, 69, 19, 0.1);
}

.legends .sheet-tabs .item.active {
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  color: #fff;
  border-bottom: 3px solid var(--d8-gold);
}

/* ========================================
   SHEET BODY
   ======================================== */

.legends .sheet-body {
  flex: 1;
  display: flex;
  overflow: hidden;
}

.legends .tab {
  padding: 10px;
  overflow-y: auto;
  flex: 1;
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: var(--d8-border) transparent; /* Firefox */
}

/* Webkit browsers (Chrome, Safari, Edge) - force scrollbar visibility */
.legends .tab::-webkit-scrollbar {
  width: 10px;
}

.legends .tab::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.1);
  border-radius: 4px;
}

.legends .tab::-webkit-scrollbar-thumb {
  background: var(--d8-border);
  border-radius: 4px;
}

.legends .tab::-webkit-scrollbar-thumb:hover {
  background: var(--d8-accent);
}

.legends .tab.description {
  padding: 0;
}

/* ========================================
   CHARACTER SHEET - MAIN TAB LAYOUT
   ======================================== */

.legends.sheet.actor.character .sheet-body {
  flex: 1;
  min-height: 0;
}

.legends .main-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  min-height: 0; /* Allow grid to shrink within flex container */
  flex: 1;
}

.legends .main-layout h3 {
  margin: 0 0 15px 0;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--d8-border);
  color: var(--d8-text);
  font-size: 16px;
  text-transform: uppercase;
}

.legends .skills-column,
.legends .stats-column {
  overflow-y: auto;
}

/* === Skills Section === */
.legends .skills-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.legends .skill-row {
  display: flex;
  align-items: left;
  gap: 6px;
  padding: 4px 8px;
  background: var(--d8-bg-light);
  border-radius: 3px;
  border: 1px solid var(--d8-border);
}

.legends .skill-row:hover {
  background: #edf2f7;
}

.legends .skill-row .skill-name {
  flex: 1;
  font-weight: 500;
  font-size: 12px;
  color: var(--d8-text);
}

.legends .skill-row .skill-attr {
  font-size: 10px;
  color: var(--d8-secondary);
  font-style: italic;
}


.legends .skill-row .skill-base {
  width: 38px;
  padding: 2px 4px;
  text-align: center;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: white;
  font-weight: bold;
  color: var(--d8-text);
}

.legends .skill-row .skill-bonus {
  width: 32px;
  text-align: center;
  font-size: 11px;
  color: var(--d8-info);
  font-weight: 500;
  cursor: help;
  border-radius: 2px;
  background: #e6f0fa;
  margin-left: 2px;
  margin-right: 2px;
}

.legends .skill-row .skill-total {
  width: 38px;
  text-align: center;
  font-size: 12px;
  color: var(--d8-success);
  font-weight: bold;
  background: #f0fff4;
  border-radius: 2px;
  margin-left: 2px;
}

.legends .skill-row [data-action="skillRoll"] {
  padding: 3px 6px;
  max-width: 28px;
  height: 24px;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  border: 1px solid var(--d8-accent);
  border-radius: 3px;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.legends .skill-row [data-action="skillRoll"] i {
  font-size: 12px;
  margin: 0;
}

.legends .skill-row [data-action="skillRoll"]:hover {
  background: linear-gradient(to bottom, var(--d8-accent), #1a202c);
  transform: translateY(-1px);
}
/* === Attributes Section === */
.legends .attributes-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 15px;
}

.legends .attribute-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 8px;
  background: var(--d8-bg-light);
  border-radius: 3px;
  border: 1px solid var(--d8-border);
}

.legends .attribute-row label {
  font-weight: bold;
  font-size: 11px;
  color: var(--d8-text);
  flex: 1;
}

.legends .attribute-row .attribute-value {
  width: 48px;
  padding: 2px 6px;
  text-align: center;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: white;
  font-weight: bold;
  color: var(--d8-text);
}

.legends .attribute-row .attribute-bonus {
  width: 32px;
  text-align: center;
  font-size: 11px;
  color: var(--d8-info);
  font-weight: 500;
  cursor: help;
  border-radius: 2px;
  background: #e6f0fa;
  margin-left: 2px;
  margin-right: 2px;
}

.legends .attribute-row .attribute-total {
  width: 38px;
  text-align: center;
  font-size: 12px;
  color: var(--d8-success);
  font-weight: bold;
  background: #f0fff4;
  border-radius: 2px;
  margin-left: 2px;
}

/* === Resources Section === */
.legends .resources-section {
  margin-bottom: 15px;
}

.legends .resource-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  background: var(--d8-bg-light);
  border-radius: 3px;
  border: 1px solid var(--d8-border);
  margin-bottom: 6px;
}

.legends .resource-row label {
  font-weight: bold;
  font-size: 12px;
  color: var(--d8-text);
  min-width: 60px;
}

.legends .resource-row .resource-current {
  width: 60px;
  padding: 3px 6px;
  text-align: center;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: white;
  font-weight: bold;
  color: var(--d8-text);
}

.legends .resource-row .sep {
  color: var(--d8-secondary);
  font-weight: bold;
}

.legends .resource-row .resource-max {
  font-weight: bold;
  color: var(--d8-text);
}

.legends .resource-row .temp-hp-section {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 4px;
}

.legends .resource-row .temp-hp-section .temp-label {
  font-size: 10px;
  color: var(--d8-success);
  font-weight: 600;
  min-width: auto;
}

.legends .resource-row .temp-hp-section .temp-hp-input {
  width: 50px;
  padding: 2px 4px;
  text-align: center;
  border: 1px solid var(--d8-success);
  border-radius: 3px;
  background: #f0fff4;
  font-weight: bold;
  color: var(--d8-success);
  font-size: 11px;
}

.legends .resource-row.hp-row {
  border-left: 4px solid var(--d8-danger);
}

.legends .resource-row.luck-row {
  border-left: 4px solid var(--d8-info);
}

.legends .resource-row.energy-row {
  border-left: 4px solid #9f7aea;
}

.legends .resource-row.dr-row {
  border-left: 4px solid var(--d8-success);
}

.legends .resource-row .dr-value {
  font-weight: bold;
  color: var(--d8-text);
  font-size: 14px;
}

/* === Rest Buttons === */
.legends .rest-buttons {
  display: flex;
  max-width: 180px;
  flex-direction: column;
  gap: 8px;
  margin-top: 15px;
}

.legends .rest-buttons button {
  padding: 10px 15px;
  border: 2px solid transparent;
  border-radius: 4px;
  font-weight: bold;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.legends .rest-buttons [data-action="shortRest"] {
  background: linear-gradient(to bottom, var(--d8-info), #3182ce);
  color: white;
  border-color: #2c5282;
}

.legends .rest-buttons [data-action="shortRest"]:hover {
  background: linear-gradient(to bottom, #3182ce, #2c5282);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.legends .rest-buttons [data-action="longRest"] {
  background: linear-gradient(to bottom, #805ad5, #6b46c1);
  color: white;
  border-color: #553c9a;
}

.legends .rest-buttons [data-action="longRest"]:hover {
  background: linear-gradient(to bottom, #6b46c1, #553c9a);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.legends .rest-buttons button i {
  font-size: 14px;
}

/* ========================================
   INVENTORY & ITEMS
   Enhanced with collapsible functionality
   ======================================== */

.legends .items-list {
  list-style: none;
  margin: 10px 0;
  padding: 0;
}

/* Existing items (backward compatibility) */
.legends .items-list .item {
  display: flex;
  align-items: center;
  padding: 6px 10px;
  border: 1px solid var(--d8-border);
  border-top: none;
  background: white;
  transition: background 0.15s;
}

/* Collapsible items (new system) */
.legends .items-list .item-collapsible {
  border: 1px solid var(--d8-border);
  border-top: none;
  background: white;
  transition: all 0.15s ease;
}

.legends .items-list .item:hover,
.legends .items-list .item-collapsible:hover {
  background: var(--d8-bg-light);
}

.legends .items-list .item:last-child,
.legends .items-list .item-collapsible:last-child {
  border-radius: 0 0 3px 3px;
}

/* Enhanced item header for collapsible items */
.legends .item-collapsible .item-header {
  display: flex;
  align-items: center;
  padding: 6px 10px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.legends .item-collapsible.expanded .item-header {
  background: rgba(74, 85, 104, 0.08);
  border-bottom: 1px solid var(--d8-border);
}

/* Quick stats for different item types */
.legends .item-quick-stats {
  display: flex;
  gap: 0.75rem;
  align-items: center;
  margin-left: auto;
  margin-right: 0.75rem;
  font-size: 0.75rem;
  color: var(--d8-secondary);
}

.legends .item-attack,
.legends .item-damage,
.legends .item-dr {
  font-weight: 600;
  padding: 0.125rem 0.375rem;
  background: rgba(74, 85, 104, 0.1);
  border-radius: 3px;
  white-space: nowrap;
}

/* Item info containers for complex layouts */
.legends .feat-info,
.legends .weave-info,
.legends .trait-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
  min-width: 0; /* Allow text truncation */
}

.legends .feat-usage,
.legends .weave-type,
.legends .weave-cost,
.legends .trait-category,
.legends .action-cost {
  font-size: 0.65rem;
  color: var(--d8-secondary);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.025rem;
}

.legends .weave-meta {
  display: flex;
  gap: 0.5rem;
}

/* Responsive adjustments */
@media (max-width: 600px) {
  .legends .item-header {
    flex-wrap: wrap;
    padding: 8px 10px;
  }
  
  .legends .item-quick-stats {
    order: 3;
    flex: 1 1 100%;
    justify-content: flex-start;
    margin: 0.25rem 0 0 1.5rem;
  }
  
  .legends .item-controls {
    flex-shrink: 0;
  }
}

/* Items header (backward compatibility) */
.legends .items-header {
  display: flex;
  padding: 6px 10px;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  color: white;
  font-weight: bold;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: 3px 3px 0 0;
}

/* Weave List Header Alignment - More specific selector */
.legends .weave-list .items-header {
  display: flex !important;
  align-items: center;
  padding: 6px 10px;
  padding-left: 30px; /* Account for caret space in items */
  gap: 0.75rem;
}

.legends .weave-list .items-header .item-image {
  flex: 0 0 24px !important;
  text-align: center;
}

.legends .weave-list .items-header .item-name {
  flex: 1 !important;
  text-align: left;
}

.legends .weave-list .items-header .energy-display {
  flex: 0 0 80px !important;
  text-align: center;
  font-size: 10px;
}

.legends .weave-list .items-header .item-detail {
  flex: 0 0 60px !important;
  text-align: center;
  font-size: 10px;
}

.legends .weave-list .items-header .item-controls {
  flex: 0 0 120px !important;
  text-align: center;
  font-size: 10px;
}

.legends .item-image {
  flex: 0 0 24px;
  margin-right: 8px;
}

.legends .item-image img {
  border: 1px solid var(--d8-border);
  border-radius: 2px;
}

.legends .items-header .item-name {
  color: white;
}

.legends .item-name {
  flex: 2;
  margin: 0;
  font-size: 13px;
  font-weight: 500;
  color: var(--d8-text);
}

.legends .item-detail {
  flex: 0 0 80px;
  text-align: center;
  font-size: 12px;
  color: white;
}

.legends .item-controls {
  display: flex;
  gap: 4px;
  flex: 0 0 120px !important;
  justify-content: center;
}

.legends .item-control {
  padding: 4px 6px;
  border-radius: 2px;
  cursor: pointer;
  color: var(--d8-primary);
  transition: all 0.15s;
}

.legends .item-control:hover {
  background: #edf2f7;
  color: var(--d8-accent);
}

.legends .item-control.equipped,
.legends [data-action="itemEquip"].equipped {
  color: var(--d8-success);
}

.legends [data-action="itemRoll"] {
  color: var(--d8-info);
}

.legends [data-action="itemDelete"] {
  color: var(--d8-danger);
}

/* Inventory Section Headers */
.legends .inventory-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 15px 0 10px 0;
}

.legends .inventory-header:first-child {
  margin-top: 0;
}

.legends .inventory-header h3 {
  margin: 0;
  font-size: 14px;
  color: var(--d8-text);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  flex: 1;
}

.legends .inventory-header button {
  padding: 6px 12px;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  max-width: 120px;
  color: white;
  border: 1px solid var(--d8-accent);
  border-radius: 3px;
  font-size: 11px;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.legends .inventory-header button:hover {
  background: linear-gradient(to bottom, var(--d8-accent), #1a202c);
  transform: translateY(-1px);
}

.legends .inventory-header button i {
  margin-right: 4px;
  font-size: 10px;
}

/* ========================================
   FEATURES TAB
   ======================================== */

.legends .features-layout {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
}

.legends .feature-section {
  border: 1px solid var(--d8-border);
  border-radius: 4px;
  padding: 10px;
  background: var(--d8-bg-light);
}

/* ========================================
   MAGIC TAB
   ======================================== */

.legends .weave-energies {
  margin-bottom: 20px;
  padding: 12px;
  background: var(--d8-bg-light);
  border: 1px solid var(--d8-border);
  border-radius: 4px;
}

.legends .weave-energies h4 {
  margin: 0 0 10px 0;
  font-size: 12px;
  color: var(--d8-text);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.legends .energy-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
}

.legends .energy-item {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.legends .energy-item label {
  font-size: 11px;
  font-weight: bold;
  color: var(--d8-primary);
}

.legends .energy-item input {
  padding: 4px;
  text-align: center;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: white;
  font-weight: bold;
}

/* === Action Cost Display === */
.legends .action-cost {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 11px;
}

.legends .action-cost i {
  font-size: 12px;
}

.legends .action-cost i.fa-running {
  color: var(--d8-info);
}

.legends .action-cost i.fa-bolt {
  color: #9f7aea;
}

.legends .action-cost i.fa-clover {
  color: var(--d8-success);
}

/* ========================================
   FORM ELEMENTS
   ======================================== */

.legends .form-group {
  margin-bottom: 10px;
}

.legends .form-group label {
  display: block;
  font-weight: bold;
  margin-bottom: 4px;
  color: var(--d8-text);
  font-size: 12px;
}

.legends .form-group small {
  display: block;
  color: var(--d8-secondary);
  font-size: 11px;
  margin-top: 2px;
}

.legends .form-group input[type="number"],
.legends .form-group input[type="text"],
.legends .form-group select,
.legends .form-group textarea {
  width: 100%;
  padding: 5px 8px;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: #fff;
  font-family: inherit;
  font-size: 13px;
}

.legends .form-group input:focus,
.legends .form-group select:focus,
.legends .form-group textarea:focus {
  outline: none;
  border-color: var(--d8-info);
  box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.legends .form-group-row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.legends .form-group-row .form-group {
  flex: 1;
}

/* ========================================
   ITEM SHEET SPECIFIC STYLES
   ======================================== */

/* Generic Item Sheet Header */
.legends.sheet.item .sheet-header {
  flex: 0 0 auto;
  padding: 10px;
  border-bottom: 2px solid #7a7971;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  color: white;
}

.legends.sheet.item .profile-img {
  border: 3px solid var(--d8-gold);
  border-radius: 4px;
  cursor: pointer;
}

.legends.sheet.item .header-fields {
  flex: 1;
  margin-left: 10px;
}

.legends.sheet.item .charname {
  margin: 0;
}

.legends.sheet.item .charname input {
  font-size: 24px;
  font-weight: bold;
  border: none;
  background: transparent;
  color: white;
  width: 100%;
}

/* === Section Headers === */
.legends .section-header {
  margin-top: 15px;
  margin-bottom: 10px;
}

.legends .section-header:first-child {
  margin-top: 0;
}

.legends .section-header h3 {
  margin: 0;
  padding: 6px 10px;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  color: #fff;
  border-radius: 3px;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* === Checkbox Labels === */
.legends label.checkbox {
  display: flex;
  align-items: center;
  cursor: pointer;
  padding: 5px;
}

.legends label.checkbox input[type="checkbox"] {
  margin-right: 8px;
}

.legends label.checkbox strong {
  font-size: 14px;
  color: var(--d8-text);
}

/* ========================================
   FEAT SHEET SPECIFIC
   ======================================== */

/* Description tab: constrain editor heights so benefits is visible */
.legends.sheet.item .feat-description-section,
.legends.sheet.item .feat-benefits-section {
  margin-bottom: 8px;
}

.legends.sheet.item .feat-description-section h3,
.legends.sheet.item .feat-benefits-section h3 {
  margin: 0 0 4px 0;
  padding: 4px 8px;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  color: #fff;
  border-radius: 3px;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.legends.sheet.item .feat-editor-wrap {
  max-height: 140px;
  overflow-y: auto;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
}

.legends.sheet.item .feat-editor-wrap .editor {
  min-height: 60px;
}

/* Prerequisites grid: 4 columns */
.legends .prerequisites-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
  margin-bottom: 12px;
}

.legends .prerequisites-grid .form-group {
  margin-bottom: 0;
}

.legends .prerequisites-grid label {
  font-size: 11px;
  color: var(--d8-secondary);
}

.legends .prerequisites-grid input {
  width: 100%;
}

/* Effects builder */
.legends.sheet.item .effects-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 6px 10px;
  background: linear-gradient(to bottom, var(--d8-primary), var(--d8-accent));
  border-radius: 4px;
  margin-bottom: 10px;
}

.legends.sheet.item .effects-header h3 {
  margin: 0;
  color: #fff;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.legends.sheet.item .effects-header .add-effect {
  padding: 4px 12px;
  background: var(--d8-success);
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
  transition: background 0.2s;
}

.legends.sheet.item .effects-header .add-effect:hover {
  background: #38a169;
}

.legends.sheet.item .effect-entry {
  background: var(--d8-bg-light);
  border: 1px solid var(--d8-border);
  border-left: 3px solid var(--d8-info);
  border-radius: 4px;
  padding: 8px 10px;
  margin-bottom: 8px;
}

.legends.sheet.item .effect-entry-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}

.legends.sheet.item .effect-entry-header .effect-number {
  font-weight: 700;
  font-size: 12px;
  color: var(--d8-info);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.legends.sheet.item .effect-entry-header .remove-effect {
  padding: 2px 8px;
  background: var(--d8-danger);
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-size: 11px;
  transition: background 0.2s;
}

.legends.sheet.item .effect-entry-header .remove-effect:hover {
  background: #c53030;
}

.legends.sheet.item .effect-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  margin-bottom: 6px;
}

.legends.sheet.item .effect-grid .form-group {
  margin-bottom: 0;
}

.legends.sheet.item .effect-grid label {
  display: block;
  font-size: 10px;
  font-weight: 600;
  color: var(--d8-secondary);
  text-transform: uppercase;
  margin-bottom: 2px;
}

.legends.sheet.item .effect-grid select,
.legends.sheet.item .effect-grid input {
  width: 100%;
  font-size: 12px;
  padding: 3px 5px;
}

.legends.sheet.item .effect-notes label {
  font-size: 10px;
  font-weight: 600;
  color: var(--d8-secondary);
  text-transform: uppercase;
}

.legends.sheet.item .effect-notes textarea {
  width: 100%;
  font-size: 12px;
  padding: 3px 5px;
  resize: vertical;
}

/* ========================================
   WEAPON SHEET SPECIFIC
   ======================================== */

/* Weapons list structure */
.legends .weapon-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
/* Header row */
.legends .weapon-list .items-header {
  display: flex;
  align-items: center;
  padding: 8px 8px 8px 30px;
  background: linear-gradient(to bottom, #4a5568, #2d3748);
  border-radius: 4px 4px 0 0;
  margin-bottom: 2px;
}

.legends .weapon-list .items-header .item-name {
  color: white !important;
  font-weight: bold;
  font-size: 12px;
  text-transform: uppercase;
}

/* Collapsible weapon items */
.legends .weapon-list .item-collapsible {
  border-bottom: 1px solid #e5e7eb;
}

.legends .weapon-list .item-header {
  display: flex;
  align-items: center;
  padding: 8px;
  transition: background-color 0.2s;
  cursor: pointer;
}

.legends .weapon-list .item-header:hover {
  background-color: rgba(0, 0, 0, 0.02);
}

/* Column widths using direct child selectors */
.legends .weapon-list .items-header > .item-image,
.legends .weapon-list .item-header > .item-image {
  flex: 0 0 32px;
  margin-right: 8px;
}

.legends .weapon-list .items-header > .item-name,
.legends .weapon-list .item-header > .item-name {
  flex: 1 1 auto;
  min-width: 0;
  font-size: 14px;
  font-weight: 500;
}

.legends .weapon-list .items-header > .item-attack,
.legends .weapon-list .item-header > .item-attack {
  flex: 0 0 100px;
  display: flex;
  gap: 4px;
  justify-content: center;
  align-items: center;
}

.legends .weapon-list .items-header > .item-damage,
.legends .weapon-list .item-header > .item-damage {
  flex: 0 0 120px;
  text-align: center;
  font-size: 13px;
}

.legends .weapon-list .items-header > .item-controls,
.legends .weapon-list .item-header > .item-controls {
  flex: 0 0 100px;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Item summary content */
.legends .weapon-list .item-summary {
  padding: 12px 12px 12px 42px;
  background-color: #f9fafb !important;
  border-top: 1px solid #e5e7eb;
  font-size: 13px;
  line-height: 1.6;
  color: #374151 !important;
}

.legends .weapon-list .item-summary h4 {
  margin: 0 0 8px 0;
  font-size: 14px;
  font-weight: 600;
  color: #1f2937 !important;
}

.legends .weapon-list .item-summary .summary-row {
  margin-bottom: 6px;
}

.legends .weapon-list .item-summary .summary-label {
  font-weight: 600;
  color: #4b5563 !important;
}

/* Weapon summary detail rows - more compact */
.legends .weapon-list .item-summary .details-section {
  width: fit-content !important;
  max-width: 500px !important;
}

.legends .weapon-list .item-summary .detail-row {
  display: flex !important;
  justify-content: flex-start !important;
  align-items: center;
  padding: 0.25rem 0;
  gap: 0.5rem;
  width: fit-content !important;
}

.legends .weapon-list .item-summary .detail-label {
  font-weight: 600 !important;
  color: var(--d8-primary) !important;
  width: auto !important;
  min-width: 0 !important;
  flex: 0 0 auto !important;
  white-space: nowrap;
}

.legends .weapon-list .item-summary .detail-value {
  color: var(--d8-text) !important;
  flex: 0 0 auto !important;
  width: auto !important;
}

/* Attack buttons styling */
.legends .weapon-attack-btn {
  width: 40px;
  height: 32px;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.15);
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 14px;
}

.legends .weapon-attack-btn:hover {
  background: rgba(0, 0, 0, 0.1);
  border-color: rgba(0, 0, 0, 0.25);
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.legends .weapon-attack-btn:active {
  transform: translateY(0);
  box-shadow: none;
}

/* Melee attack button */
.legends .weapon-attack-btn.melee-attack {
  color: #dc2626;
}

.legends .weapon-attack-btn.melee-attack:hover {
  background: rgba(220, 38, 38, 0.1);
  border-color: rgba(220, 38, 38, 0.3);
}

/* Ranged attack button */
.legends .weapon-attack-btn.ranged-attack {
  color: #2563eb;
}

.legends .weapon-attack-btn.ranged-attack:hover {
  background: rgba(37, 99, 235, 0.1);
  border-color: rgba(37, 99, 235, 0.3);
}

/* Item controls */
.legends .weapon-list .item-control {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  color: var(--d8-text);
}

.legends .weapon-list .item-control:hover {
  opacity: 1;
}

.legends .weapon-list .item-header .item-name {
  display: inline;
}

/* Equip indicator */
.legends .weapon-list .item-header [data-action="itemEquip"].equipped i {
  color: #10b981;
}

.legends .weapon-list [data-action="itemEquip"]:not(.equipped) i {
  color: #9ca3af;
}
/* Item controls spacing */
.legends .weapon-list .item-header .item-controls {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}
/* Edit button */
.legends .weapon-list [data-action="itemEdit"] i {
  color: #3b82f6;
}

/* Delete button */
.legends .weapon-list [data-action="itemDelete"] i {
  color: #ef4444;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 768px) {
  .legends .weapon-list .item-damage {
    flex: 0 0 100px;
    font-size: 12px;
  }
  
  .legends .weapon-list .item-attack {
    flex: 0 0 90px;
  }
  
  .legends .weapon-list .item-controls {
    flex: 0 0 80px;
    gap: 4px;
  }
}
   /* Visual Tags in Header */
.legends.sheet .weapon-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin: 8px 0;
  min-height: 24px;
}

.legends.sheet .weapon-tags:empty {
  display: none !important;
}

.legends.sheet .weapon-tags .tag {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 3px;
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  color: #fff;
  background: #666;
  border: 1px solid #444;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.legends.sheet .weapon-tags .tag.property-tag {
  background: linear-gradient(to bottom, var(--d8-info), #3182ce);
  border-color: #2c5282;
}

.legends.sheet .weapon-tags .tag.damage-tag {
  background: linear-gradient(to bottom, #fc8181, var(--d8-danger));
  border-color: #c53030;
}

.legends.sheet .weapon-tags .tag.range-tag {
  background: linear-gradient(to bottom, #68d391, var(--d8-success));
  border-color: #38a169;
}

/* Summary Stats Row in Header */
.legends.sheet .weapon-summary-row {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  margin-top: 8px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 4px;
  border: 1px solid var(--d8-border);
}

.legends .sheet-header .weapon-summary-row {
  background: rgba(0, 0, 0, 0.2) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

.legends .sheet-header .weapon-summary-row .summary-stat label {
  color: rgba(255, 255, 255, 0.7) !important;
}

.legends .sheet-header .weapon-summary-row .summary-stat .value {
  color: #FFFFFF !important;
}

.legends.sheet .summary-stat {
  display: flex;
  flex-direction: column;
  min-width: 80px;
}

.legends.sheet .summary-stat label {
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  color: var(--d8-secondary);
  margin-bottom: 2px;
}

.legends.sheet .summary-stat .value {
  font-size: 14px;
  font-weight: bold;
  color: var(--d8-text);
}

/* Editable Quantity in Header */
.legends.sheet .summary-stat.editable {
  position: relative;
}

.legends.sheet .summary-stat .qty-input {
  width: 50px;
  text-align: center;
  font-size: 14px;
  font-weight: bold;
  color: var(--d8-text);
  border: 1px solid transparent;
  background: transparent;
  padding: 2px 4px;
  border-radius: 3px;
  transition: all 0.2s;
}

.legends.sheet .summary-stat .qty-input:hover {
  border-color: var(--d8-border);
  background: rgba(255, 255, 255, 0.5);
}

.legends.sheet .summary-stat .qty-input:focus {
  outline: none;
  border-color: var(--d8-info);
  background: #fff;
  box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.1);
}

/* Property Categories */
.legends.sheet .properties-grid {
  padding: 10px;
  background: rgba(0, 0, 0, 0.02);
  border-radius: 4px;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.legends.sheet .property-category {
  padding: 10px;
  background: #fff;
  border: 1px solid var(--d8-border);
  border-radius: 4px;
}

.legends.sheet .property-category h4 {
  margin: 0 0 10px 0;
  padding: 5px 8px;
  background: var(--d8-bg-light);
  border-left: 4px solid var(--d8-info);
  font-size: 12px;
  font-weight: bold;
  color: var(--d8-text);
}

/* Checkbox Property Layout */
.legends.sheet .checkbox-property {
  display: flex;
  align-items: flex-start;
  padding: 8px;
  margin: 5px 0;
  background: #fafafa;
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  cursor: pointer;
  transition: all 0.2s;
}

.legends.sheet .checkbox-property:hover {
  background: var(--d8-bg-light);
  border-color: var(--d8-info);
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.legends.sheet .checkbox-property input[type="checkbox"] {
  margin: 2px 8px 0 0;
  flex-shrink: 0;
  cursor: pointer;
}

.legends.sheet .checkbox-property .property-info {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.legends.sheet .checkbox-property .property-name {
  font-weight: 600;
  color: var(--d8-text);
  font-size: 13px;
  margin-bottom: 3px;
  display: block;
}

.legends.sheet .checkbox-property .property-desc {
  color: var(--d8-secondary);
  font-size: 11px;
  line-height: 1.4;
  display: block;
}

.legends.sheet .checkbox-property input[type="checkbox"]:checked ~ .property-info .property-name {
  color: #2b6cb0;
  font-weight: bold;
}

/* Damage Explanation Box */
.legends.sheet .damage-explanation {
  margin: 15px 0;
  padding: 12px;
  background: var(--d8-bg-light);
  border-left: 4px solid var(--d8-info);
  border-radius: 4px;
}

.legends.sheet .damage-explanation h4 {
  margin: 0 0 10px 0;
  color: var(--d8-text);
  font-size: 13px;
  font-weight: bold;
}

.legends.sheet .damage-explanation ul {
  margin: 8px 0;
  padding-left: 20px;
  list-style-type: disc;
}

.legends.sheet .damage-explanation li {
  margin: 5px 0;
  line-height: 1.4;
  color: var(--d8-primary);
}

.legends.sheet .damage-explanation li strong {
  color: var(--d8-text);
}

.legends.sheet .damage-explanation p {
  margin: 8px 0 0 0;
  color: var(--d8-secondary);
  font-style: italic;
}

.legends.sheet .damage-explanation small {
  font-size: 11px;
}

/* Attack Modes List */
.attack-modes-list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.attack-mode-item {
  border: 1px solid var(--d8-border);
  border-radius: 4px;
  padding: 10px;
  background: var(--d8-bg-light);
}

.mode-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--d8-border);
}

.mode-header h4 {
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.remove-attack-mode {
  background: var(--d8-danger);
  color: white;
  border: none;
  padding: 5px 10px;
  border-radius: 3px;
  cursor: pointer;
  font-size: 12px;
}

.add-attack-mode {
  background: var(--d8-accent);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  width: 100%;
}

.add-attack-mode:hover,
.remove-attack-mode:hover {
  opacity: 0.8;
}

/* ========================================
   ARMOR SHEET SPECIFIC
   ======================================== */

/* Armor/Shield Conditional Display */
.legends.sheet .armor-only-fields,
.legends.sheet .shield-only-fields {
  transition: all 0.3s ease;
}

.legends.sheet .shield-abilities-display {
  margin-top: 10px;
  padding: 10px;
  background: var(--d8-bg-light);
  border-radius: 4px;
  border: 1px solid var(--d8-border);
}

.legends.sheet .shield-abilities-info p {
  margin: 5px 0;
  line-height: 1.5;
}

.legends.sheet .shield-abilities-info p strong {
  color: var(--d8-text);
}

.legends.sheet .shield-abilities-info .hint {
  color: #999;
  font-style: italic;
}

/* Armor Tags in Header */
.legends.sheet .armor-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin: 8px 0;
  min-height: 24px;
}

.legends.sheet .armor-tags .tag {
  display: inline-block;
  padding: 3px 8px;
  border-radius: 3px;
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  color: #fff;
  border: 1px solid #444;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
}

.legends.sheet .armor-tags .tag.armor-type-tag {
  background: linear-gradient(to bottom, #a0aec0, #718096);
  border-color: var(--d8-primary);
}

.legends.sheet .armor-tags .tag.shield-type-tag {
  background: linear-gradient(to bottom, var(--d8-info), #3182ce);
  border-color: #2c5282;
}

.legends.sheet .armor-tags .tag.stealth-tag {
  background: linear-gradient(to bottom, #fc8181, var(--d8-danger));
  border-color: #c53030;
}

.legends.sheet .armor-tags .tag.dr-tag {
  background: linear-gradient(to bottom, #68d391, var(--d8-success));
  border-color: #38a169;
}

/* Armor Summary Stats Row */
.legends.sheet .armor-summary-row {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  margin-top: 8px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.05);
  border-radius: 4px;
  border: 1px solid var(--d8-border);
}

.legends .sheet-header .armor-summary-row {
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.legends .sheet-header .armor-summary-row .summary-stat label {
  color: rgba(255, 255, 255, 0.7);
}

.legends .sheet-header .armor-summary-row .summary-stat .value {
  color: #FFFFFF;
}

/* Weakness Tag - Orange gradient */
.legends.sheet .armor-tags .tag.weakness-tag {
  background: linear-gradient(to bottom, #f6ad55, #ed8936);
  border-color: #c05621;
  text-transform: capitalize;
}

/* Resistance Tag - Blue gradient */
.legends.sheet .armor-tags .tag.resistance-tag {
  background: linear-gradient(to bottom, #4299e1, #3182ce);
  border-color: #2c5282;
  text-transform: capitalize;
}

/* Help section styling for armor DR explanation */
.legends.sheet .help-section {
  background: #f7fafc;
  padding: 10px;
  border-radius: 4px;
  margin: 10px 0;
  border: 1px solid #e2e8f0;
}

.legends.sheet .help-section h4 {
  margin: 0 0 5px 0;
  color: #2d3748;
  font-size: 13px;
}

.legends.sheet .help-section ul {
  margin: 5px 0;
  padding-left: 20px;
  font-size: 12px;
  list-style-type: disc;
}

.legends.sheet .help-section ul li {
  margin: 3px 0;
  color: #4a5568;
}

.legends.sheet .help-section p {
  margin: 5px 0;
  font-size: 11px;
  font-style: italic;
  color: #718096;
}

/* Hint text for base DR display */
.legends.sheet .hint {
  color: #666;
  font-size: 12px;
  margin: 5px 0;
  font-style: normal;
}

.legends.sheet .hint strong {
  color: #2d3748;
  font-weight: bold;
}

/* ========================================
   ARMOR LIST COLLAPSIBLE SYSTEM
   ======================================== */

/* Armor List Container */
.legends .armor-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* Header row */
.legends .armor-list .items-header {
  display: flex;
  align-items: center;
  padding: 8px 8px 8px 30px;
  background: linear-gradient(to bottom, #4a5568, #2d3748);
  border-radius: 4px 4px 0 0;
  margin-bottom: 2px;
}

.legends .armor-list .items-header .item-name,
.legends .armor-list .items-header .item-dr,
.legends .armor-list .items-header .item-penalty,
.legends .armor-list .items-header .item-controls {
  color: white !important;
  font-weight: bold;
  font-size: 12px;
  text-transform: uppercase;
}

/* Collapsible armor items */
.legends .armor-list .item-collapsible {
  border-bottom: 1px solid #e5e7eb;
}

.legends .armor-list .item-header {
  display: flex;
  align-items: center;
  padding: 8px;
  transition: background-color 0.2s;
  cursor: pointer;
}

.legends .armor-list .item-header:hover {
  background-color: rgba(0, 0, 0, 0.02);
}

/* Column widths using direct child selectors */
.legends .armor-list .items-header > .item-image,
.legends .armor-list .item-header > .item-image {
  flex: 0 0 32px;
  margin-right: 8px;
}

.legends .armor-list .items-header > .item-name,
.legends .armor-list .item-header > .item-name {
  flex: 1 1 auto;
  min-width: 0;
  font-size: 14px;
  font-weight: 500;
}

.legends .armor-list .items-header > .item-dr,
.legends .armor-list .item-header > .item-dr {
  flex: 0 0 150px;
  text-align: center;
  font-size: 13px;
}

.legends .armor-list .items-header > .item-penalty,
.legends .armor-list .item-header > .item-penalty {
  flex: 0 0 80px;
  text-align: center;
  font-size: 13px;
}

.legends .armor-list .items-header > .item-controls,
.legends .armor-list .item-header > .item-controls {
  flex: 0 0 100px;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Item summary content */
.legends .armor-list .item-summary {
  padding: 12px 12px 12px 42px;
  background-color: #f9fafb !important;
  border-top: 1px solid #e5e7eb;
  font-size: 13px;
  line-height: 1.6;
  color: #374151 !important;
}

.legends .armor-list .item-summary h4 {
  margin: 0 0 8px 0;
  font-size: 14px;
  font-weight: 600;
  color: #1f2937 !important;
}

/* Armor summary detail rows - compact */
.legends .armor-list .item-summary .details-section {
  width: fit-content !important;
  max-width: 500px !important;
}

.legends .armor-list .item-summary .detail-row {
  display: flex !important;
  justify-content: flex-start !important;
  align-items: center;
  padding: 0.25rem 0;
  gap: 0.5rem;
  width: fit-content !important;
}

.legends .armor-list .item-summary .detail-label {
  font-weight: 600 !important;
  color: var(--d8-primary) !important;
  width: auto !important;
  min-width: 0 !important;
  flex: 0 0 auto !important;
  white-space: nowrap;
}

.legends .armor-list .item-summary .detail-value {
  color: var(--d8-text) !important;
  flex: 0 0 auto !important;
  width: auto !important;
}

/* Item controls */
.legends .armor-list .item-control {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  color: var(--d8-text);
}

.legends .armor-list .item-control:hover {
  opacity: 1;
}

.legends .armor-list .item-header .item-name {
  display: inline;
}

/* Equip indicator */
.legends .armor-list .item-header [data-action="itemEquip"].equipped i {
  color: #10b981;
}

.legends .armor-list [data-action="itemEquip"]:not(.equipped) i {
  color: #9ca3af;
}

/* Item controls spacing */
.legends .armor-list .item-header .item-controls {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Edit button */
.legends .armor-list [data-action="itemEdit"] i {
  color: #3b82f6;
}

/* Delete button */
.legends .armor-list [data-action="itemDelete"] i {
  color: #ef4444;
}

/* ========================================
   EQUIPMENT LIST COLLAPSIBLE SYSTEM
   ======================================== */

/* Equipment List Container */
.legends .equipment-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

/* Header row */
.legends .equipment-list .items-header {
  display: flex;
  align-items: center;
  padding: 8px 8px 8px 30px;
  background: linear-gradient(to bottom, #4a5568, #2d3748);
  border-radius: 4px 4px 0 0;
  margin-bottom: 2px;
}

.legends .equipment-list .items-header .item-name,
.legends .equipment-list .items-header .item-quantity,
.legends .equipment-list .items-header .item-controls {
  color: white !important;
  font-weight: bold;
  font-size: 12px;
  text-transform: uppercase;
}

/* Collapsible equipment items */
.legends .equipment-list .item-collapsible {
  border-bottom: 1px solid #e5e7eb;
}

.legends .equipment-list .item-header {
  display: flex;
  align-items: center;
  padding: 8px;
  transition: background-color 0.2s;
  cursor: pointer;
}

.legends .equipment-list .item-header:hover {
  background-color: rgba(0, 0, 0, 0.02);
}

/* Column widths using direct child selectors */
.legends .equipment-list .items-header > .item-image,
.legends .equipment-list .item-header > .item-image {
  flex: 0 0 32px;
  margin-right: 8px;
}

.legends .equipment-list .items-header > .item-name,
.legends .equipment-list .item-header > .item-name {
  flex: 1 1 auto;
  min-width: 0;
  font-size: 14px;
  font-weight: 500;
}

.legends .equipment-list .items-header > .item-quantity,
.legends .equipment-list .item-header > .item-quantity {
  flex: 0 0 80px !important;
  max-width: 80px !important;
  min-width: 80px !important;
  text-align: center;
  font-size: 13px;
  display: flex !important;
  justify-content: center;
  align-items: center;
  background: transparent !important;
  color: inherit !important;
  overflow: visible !important;
  padding: 0 !important;
  margin: 0 !important;
}

.legends .equipment-list .items-header > .item-controls,
.legends .equipment-list .item-header > .item-controls {
  flex: 0 0 120px;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Note: Quantity input styling handled via inline styles in template
   due to Foundry's ApplicationV2 overriding CSS selectors */

/* Item summary content */
.legends .equipment-list .item-summary {
  padding: 12px 12px 12px 42px;
  background-color: #f9fafb !important;
  border-top: 1px solid #e5e7eb;
  font-size: 13px;
  line-height: 1.6;
  color: #374151 !important;
}

.legends .equipment-list .item-summary h4 {
  margin: 0 0 8px 0;
  font-size: 14px;
  font-weight: 600;
  color: #1f2937 !important;
}

/* Equipment summary detail rows - compact */
.legends .equipment-list .item-summary .details-section {
  width: fit-content !important;
  max-width: 500px !important;
}

.legends .equipment-list .item-summary .detail-row {
  display: flex !important;
  justify-content: flex-start !important;
  align-items: center;
  padding: 0.25rem 0;
  gap: 0.5rem;
  width: fit-content !important;
}

.legends .equipment-list .item-summary .detail-label {
  font-weight: 600 !important;
  color: var(--d8-primary) !important;
  width: auto !important;
  min-width: 0 !important;
  flex: 0 0 auto !important;
  white-space: nowrap;
}

.legends .equipment-list .item-summary .detail-value {
  color: var(--d8-text) !important;
  flex: 0 0 auto !important;
  width: auto !important;
}

/* Item controls */
.legends .equipment-list .item-control {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  color: var(--d8-text);
}

.legends .equipment-list .item-control:hover {
  opacity: 1;
}

.legends .equipment-list .item-header .item-name {
  display: inline;
}

/* Item controls spacing */
.legends .equipment-list .item-header .item-controls {
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Chat button */
.legends .equipment-list [data-action="itemChat"] i {
  color: #10b981;
}

/* Edit button */
.legends .equipment-list [data-action="itemEdit"] i {
  color: #3b82f6;
}

/* Delete button */
.legends .equipment-list [data-action="itemDelete"] i {
  color: #ef4444;
}

/* ========================================
   FEAT/TRAIT/FLAW LISTS (Collapsible)
   ======================================== */

/* Common styles for all three feature lists */
.legends .feat-list,
.legends .trait-list,
.legends .flaw-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  list-style: none;
  margin: 0;
  padding: 0;
}

/* Item collapsible container */
.legends .feat-list .item-collapsible,
.legends .trait-list .item-collapsible,
.legends .flaw-list .item-collapsible {
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: rgba(255, 255, 255, 0.9);
  overflow: hidden;
}

/* Item header - always visible, clickable */
.legends .feat-list > .item-collapsible > .item-header,
.legends .trait-list > .item-collapsible > .item-header,
.legends .flaw-list > .item-collapsible > .item-header {
  display: flex;
  align-items: center;
  padding: 8px;
  gap: 8px;
  cursor: pointer;
  transition: background-color 0.15s;
}

.legends .feat-list > .item-collapsible > .item-header:hover,
.legends .trait-list > .item-collapsible > .item-header:hover,
.legends .flaw-list > .item-collapsible > .item-header:hover {
  background-color: rgba(0, 0, 0, 0.03);
}

/* Item image */
.legends .feat-list .item-header > .item-image,
.legends .trait-list .item-header > .item-image,
.legends .flaw-list .item-header > .item-image {
  flex: 0 0 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.legends .feat-list .item-header > .item-image img,
.legends .trait-list .item-header > .item-image img,
.legends .flaw-list .item-header > .item-image img {
  width: 24px;
  height: 24px;
  border: none;
}

/* Item name */
.legends .feat-list .item-header > .item-name,
.legends .trait-list .item-header > .item-name,
.legends .flaw-list .item-header > .item-name {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
  color: var(--d8-text);
  margin: 0;
}

/* Item controls */
.legends .feat-list .item-header > .item-controls,
.legends .trait-list .item-header > .item-controls,
.legends .flaw-list .item-header > .item-controls {
  flex: 0 0 auto;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Control buttons */
.legends .feat-list .item-control,
.legends .trait-list .item-control,
.legends .flaw-list .item-control {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  color: var(--d8-text);
}

.legends .feat-list .item-control:hover,
.legends .trait-list .item-control:hover,
.legends .flaw-list .item-control:hover {
  opacity: 1;
}

/* View button */
.legends .feat-list [data-action="itemView"] i,
.legends .trait-list [data-action="itemView"] i,
.legends .flaw-list [data-action="itemView"] i {
  color: #8b5cf6;
}

/* Edit button */
.legends .feat-list [data-action="itemEdit"] i,
.legends .trait-list [data-action="itemEdit"] i,
.legends .flaw-list [data-action="itemEdit"] i {
  color: #3b82f6;
}

/* Delete button */
.legends .feat-list [data-action="itemDelete"] i,
.legends .trait-list [data-action="itemDelete"] i,
.legends .flaw-list [data-action="itemDelete"] i {
  color: #ef4444;
}

/* Item summary content */
.legends .feat-list .item-summary,
.legends .trait-list .item-summary,
.legends .flaw-list .item-summary {
  padding: 12px 12px 12px 42px;
  border-top: 1px solid var(--d8-border);
  background-color: rgba(0, 0, 0, 0.02);
  display: none;
}

.legends .feat-list .item-collapsible.expanded .item-summary,
.legends .trait-list .item-collapsible.expanded .item-summary,
.legends .flaw-list .item-collapsible.expanded .item-summary {
  display: block;
}

/* Summary detail rows */
.legends .feat-list .item-summary .detail-row,
.legends .trait-list .item-summary .detail-row,
.legends .flaw-list .item-summary .detail-row {
  display: flex;
  padding: 0.25rem 0;
  gap: 0.5rem;
  width: fit-content !important;
}

.legends .feat-list .item-summary .detail-label,
.legends .trait-list .item-summary .detail-label,
.legends .flaw-list .item-summary .detail-label {
  font-weight: 600 !important;
  color: var(--d8-primary) !important;
  width: auto !important;
  min-width: 0 !important;
  flex: 0 0 auto !important;
  white-space: nowrap;
}

.legends .feat-list .item-summary .detail-value,
.legends .trait-list .item-summary .detail-value,
.legends .flaw-list .item-summary .detail-value {
  color: var(--d8-text) !important;
  flex: 0 0 auto !important;
  width: auto !important;
}

/* ========================================
   ACTION LISTS (Collapsible)
   ======================================== */

/* Common styles for all action lists */
.legends .action-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
  list-style: none;
  margin: 0;
  padding: 0;
}

/* Item collapsible container */
.legends .action-list .item-collapsible {
  border: 1px solid var(--d8-border);
  border-radius: 3px;
  background: rgba(255, 255, 255, 0.9);
  overflow: hidden;
}

/* Item header - always visible, clickable */
.legends .action-list > .item-collapsible > .item-header {
  display: flex;
  align-items: center;
  padding: 8px;
  gap: 8px;
  cursor: pointer;
  transition: background-color 0.15s;
}

.legends .action-list > .item-collapsible > .item-header:hover {
  background-color: rgba(0, 0, 0, 0.03);
}

/* Item image */
.legends .action-list .item-header > .item-image {
  flex: 0 0 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.legends .action-list .item-header > .item-image img {
  width: 24px;
  height: 24px;
  border: none;
}

/* Item name */
.legends .action-list .item-header > .item-name {
  flex: 1;
  font-size: 14px;
  font-weight: 500;
  color: var(--d8-text);
  margin: 0;
}

/* Action cost or trigger */
.legends .action-list .item-header > .item-detail {
  flex: 0 0 auto;
  font-size: 12px;
  color: var(--d8-secondary);
  font-weight: 600;
  margin-right: 8px;
}

.legends .action-list .item-header > .action-trigger {
  flex: 0 0 auto;
  font-size: 11px;
  color: var(--d8-secondary);
  font-style: italic;
  max-width: 200px;
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

/* Item controls */
.legends .action-list .item-header > .item-controls {
  flex: 0 0 auto;
  display: flex;
  gap: 8px;
  justify-content: flex-end;
  align-items: center;
}

/* Control buttons */
.legends .action-list .item-control {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  color: var(--d8-text);
}

.legends .action-list .item-control:hover {
  opacity: 1;
}

/* Chat button */
.legends .action-list [data-action="itemChat"] i {
  color: #10b981;
}

/* Edit button */
.legends .action-list [data-action="itemEdit"] i {
  color: #3b82f6;
}

/* Delete button */
.legends .action-list [data-action="itemDelete"] i {
  color: #ef4444;
}

/* Item summary content */
.legends .action-list .item-summary {
  padding: 12px 12px 12px 42px;
  border-top: 1px solid var(--d8-border);
  background-color: rgba(0, 0, 0, 0.02);
  display: none;
}

.legends .action-list .item-collapsible.expanded .item-summary {
  display: block;
}

/* Summary detail rows */
.legends .action-list .item-summary .detail-row {
  display: flex;
  padding: 0.25rem 0;
  gap: 0.5rem;
  width: fit-content !important;
}

.legends .action-list .item-summary .detail-label {
  font-weight: 600 !important;
  color: var(--d8-primary) !important;
  width: auto !important;
  min-width: 0 !important;
  flex: 0 0 auto !important;
  white-space: nowrap;
}

.legends .action-list .item-summary .detail-value {
  color: var(--d8-text) !important;
  flex: 0 0 auto !important;
  width: auto !important;
}

/* ========================================
   TEXT EDITOR
   ======================================== */

.legends.sheet .tab.description .editor {
  min-height: 300px;
}

.legends.sheet .editor {
  min-height: 200px;
  margin-bottom: 10px;
}

.legends.sheet .editor .editor-content {
  min-height: 150px;
  border: 1px solid #7a7971;
  border-radius: 3px;
  padding: 5px;
  background: rgba(0, 0, 0, 0.05);
}

/* ========================================
   COMBAT CARDS (Chat)
   ======================================== */

.legends-attack-card {
  padding: 10px;
  border: 1px solid #999;
  border-radius: 5px;
  background: #f5f5f5;
}

.legends-attack-card h3 {
  margin: 0 0 10px 0;
  color: #8B0000;
}

.legends-attack-card .attack-mode,
.legends-attack-card .attack-target,
.legends-attack-card .attack-damage {
  margin: 5px 0;
  font-size: 13px;
}

.legends-attack-card .defense-section {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #ccc;
}

.legends-attack-card .defense-button {
  width: 100%;
  padding: 8px;
  background: #2c5aa0;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
}

.legends-attack-card .defense-button:hover {
  background: #1e4080;
}

.legends-attack-card .no-target {
  margin-top: 10px;
  padding: 8px;
  background: #eee;
  border-radius: 4px;
  text-align: center;
  font-style: italic;
  color: #666;
}

/* Combat Result Cards */
.legends-combat-result {
  padding: 10px;
  border: 2px solid #8B4513;
  border-radius: 5px;
  background: #fff8dc;
}

.legends-combat-result h3 {
  margin: 0 0 10px 0;
  color: #8B4513;
}

.legends-combat-result .comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 10px 0;
  padding: 10px;
  background: white;
  border-radius: 4px;
}

.legends-combat-result .margin {
  grid-column: 1 / -1;
  text-align: center;
  font-size: 16px;
  font-weight: bold;
  color: #8B0000;
  padding: 8px;
  background: #ffe4e1;
  border-radius: 4px;
}

.legends-combat-result .damage-result {
  margin: 10px 0;
  padding: 10px;
  background: #ffe4e1;
  border-radius: 4px;
  font-size: 14px;
}

.legends-combat-result .damage-buttons {
  margin-top: 10px;
}

.legends-combat-result .apply-damage-btn {
  width: 100%;
  padding: 10px;
  background: #8B0000;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
}

.legends-combat-result .apply-damage-btn:hover {
  background: #660000;
}

/* Damage Applied Notification */
.legends-damage-applied {
  padding: 10px;
  background: #ffe4e1;
  border-left: 4px solid #8B0000;
  border-radius: 4px;
}

.legends-damage-applied i {
  color: #8B0000;
}

/* ========================================
   WEAVE CARDS (Chat)
   ======================================== */

.legends-weave-card {
  padding: 10px;
  border: 1px solid #6a5acd;
  border-radius: 5px;
  background: #f0e6ff;
}

.legends-weave-card h3 {
  margin: 0 0 10px 0;
  color: #4b0082;
}

.legends-weave-card .weave-successes,
.legends-weave-card .weave-cost,
.legends-weave-card .weave-target {
  margin: 5px 0;
  font-size: 13px;
}

.legends-weave-card .save-section {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #9370db;
}

.legends-weave-card .save-button {
  width: 100%;
  padding: 8px;
  background: #6a5acd;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
}

.legends-weave-card .save-button:hover {
  background: #483d8b;
}

.legends-weave-card .apply-section {
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid #9370db;
}

.legends-weave-card .apply-effect-button {
  width: 100%;
  padding: 8px;
  background: #8b008b;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
}

.legends-weave-card .apply-effect-button:hover {
  background: #660066;
}

.legends-weave-card .apply-damage-button {
  width: 100%;
  padding: 8px;
  background: #cc2900;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
}

.legends-weave-card .apply-damage-button:hover {
  background: #991f00;
}

.legends-weave-card .no-target {
  margin-top: 10px;
  padding: 8px;
  background: #e6e6fa;
  border-radius: 4px;
  text-align: center;
  font-style: italic;
  color: #666;
}

/* Draggable Effects */
.legends-weave-card .weave-effects-list {
  margin-top: 10px;
  padding: 10px;
  background: rgba(106, 90, 205, 0.1);
  border: 1px dashed #6a5acd;
  border-radius: 4px;
}

.legends-weave-card .weave-effects-list h4 {
  margin: 0 0 8px 0;
  font-size: 14px;
  color: #4b0082;
  font-weight: 600;
}

.legends-weave-card .weave-effects-list .effects-help {
  margin: 0 0 10px 0;
  font-size: 12px;
  font-style: italic;
  color: #666;
}

.legends-weave-card .draggable-effect {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  margin-bottom: 6px;
  background: white;
  border: 2px solid #6a5acd;
  border-radius: 4px;
  cursor: grab;
  transition: all 0.2s ease;
  user-select: none;
}

.legends-weave-card .draggable-effect:last-child {
  margin-bottom: 0;
}

.legends-weave-card .draggable-effect:hover {
  background: #f8f5ff;
  border-color: #8b008b;
  transform: translateY(-2px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.legends-weave-card .draggable-effect:active {
  cursor: grabbing;
  transform: translateY(0);
}

.legends-weave-card .draggable-effect i {
  color: #6a5acd;
  font-size: 16px;
}

.legends-weave-card .draggable-effect span {
  flex: 1;
  font-weight: 500;
  color: #333;
  text-transform: capitalize;
}

.legends-weave-card .draggable-effect .drag-hint {
  font-size: 11px;
  color: #999;
  font-style: italic;
}

/* Inline Effects (from text enrichment) */
.draggable-effect.inline-effect {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  margin: 0 4px;
  background: white;
  border: 1px solid #6a5acd;
  border-radius: 4px;
  cursor: grab;
  transition: all 0.2s ease;
  user-select: none;
  vertical-align: middle;
  font-size: 0.9em;
}

.draggable-effect.inline-effect:hover {
  background: #f8f5ff;
  border-color: #8b008b;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

.draggable-effect.inline-effect:active {
  cursor: grabbing;
  transform: translateY(0);
}

.draggable-effect.inline-effect i {
  color: #6a5acd;
  font-size: 14px;
}

.draggable-effect.inline-effect span {
  font-weight: 500;
  color: #333;
  text-transform: capitalize;
}

.draggable-effect.inline-effect .drag-hint {
  font-size: 10px;
  color: #999;
  font-style: italic;
  white-space: nowrap;
}

/* Weave Result Cards */
.legends-weave-result {
  padding: 10px;
  border: 2px solid #6a5acd;
  border-radius: 5px;
  background: #f0e6ff;
}

.legends-weave-result h3 {
  margin: 0 0 10px 0;
  color: #4b0082;
}

.legends-weave-result .comparison {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 10px 0;
  padding: 10px;
  background: white;
  border-radius: 4px;
}

.legends-weave-result .net-successes {
  grid-column: 1 / -1;
  text-align: center;
  font-size: 16px;
  font-weight: bold;
  color: #4b0082;
  padding: 8px;
  background: #e6e6fa;
  border-radius: 4px;
}

.legends-weave-result .damage-result {
  margin: 10px 0;
  padding: 10px;
  background: #e6e6fa;
  border-radius: 4px;
  font-size: 14px;
}

.legends-weave-result .damage-buttons {
  margin-top: 10px;
}

.legends-weave-result .apply-weave-damage-btn {
  width: 100%;
  padding: 10px;
  background: #4b0082;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
}

.legends-weave-result .apply-weave-damage-btn:hover {
  background: #330066;
}

/* ========================================
   UTILITY CLASSES
   ======================================== */

.capitalize {
  text-transform: capitalize;
}

.uppercase {
  text-transform: uppercase;
}

.hint {
  color: #999;
  font-style: italic;
  margin: 10px 0;
}

/* ========================================
   CONDITION SYSTEM
   ======================================== */

/* Token Condition Overlay */
.legends-condition-overlay {
  pointer-events: auto;
  z-index: 1000;
  position: fixed;
}

.legends-condition-overlay .condition-chip {
  background: rgba(0, 0, 0, 0.85);
  border: 2px solid #444;
  border-radius: 4px;
  padding: 4px 8px;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #fff;
  white-space: nowrap;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  animation: fadeIn 0.3s ease-in;
  cursor: pointer;
  transition: all 0.2s ease;
  user-select: none;
}

.legends-condition-overlay .condition-chip:hover {
  background: rgba(0, 0, 0, 0.95);
  border-color: #666;
  transform: scale(1.05);
  box-shadow: 0 4px 8px rgba(0,0,0,0.7);
}

.legends-condition-overlay .condition-chip:active {
  transform: scale(0.98);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateX(10px); }
  to { opacity: 1; transform: translateX(0); }
}

.legends-condition-overlay .condition-chip img {
  width: 20px;
  height: 20px;
  border-radius: 2px;
}

/* Condition Chat Cards */
.d8-condition-applied,
.d8-condition-removed {
  padding: 10px;
  border-left: 4px solid var(--d8-info);
  background: var(--d8-bg-light);
  border-radius: 4px;
  margin: 5px 0;
}

.d8-condition-applied {
  border-left-color: var(--d8-warning);
}

.d8-condition-removed {
  border-left-color: var(--d8-success);
}

/* Condition Damage Cards */
.d8-condition-damage {
  padding: 12px;
  border: 2px solid var(--d8-danger);
  border-radius: 5px;
  background: #fff5f5;
}

.d8-condition-damage h3 {
  margin: 0 0 10px 0;
  color: var(--d8-danger);
  font-size: 16px;
  text-transform: uppercase;
}

.d8-condition-damage .dice-roll {
  margin: 10px 0;
  padding: 10px;
  background: white;
  border-radius: 4px;
  border: 1px solid var(--d8-border);
}

.d8-condition-damage .dice-formula {
  font-size: 14px;
  color: var(--d8-text);
  margin-bottom: 5px;
}

.d8-condition-damage .dice-total {
  font-size: 24px;
  font-weight: bold;
  color: var(--d8-danger);
  margin: 5px 0;
}

.d8-condition-damage p {
  margin: 10px 0 0 0;
  font-size: 14px;
  color: var(--d8-text);
}

/* Condition Recovery Cards */
.d8-condition-recovery {
  padding: 12px;
  border: 2px solid var(--d8-info);
  border-radius: 5px;
  background: #ebf8ff;
}

.d8-condition-recovery h3 {
  margin: 0 0 10px 0;
  color: var(--d8-info);
  font-size: 16px;
  text-transform: uppercase;
}

.d8-condition-recovery p {
  margin: 10px 0;
  font-size: 14px;
  color: var(--d8-text);
}

.d8-condition-recovery .recovery-buttons {
  display: flex;
  gap: 10px;
  margin-top: 12px;
}

.d8-condition-recovery button {
  flex: 1;
  padding: 10px 15px;
  border: none;
  border-radius: 4px;
  font-weight: bold;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
}

.d8-condition-recovery .recovery-roll {
  background: linear-gradient(to bottom, var(--d8-info), #3182ce);
  color: white;
}

.d8-condition-recovery .recovery-roll:hover {
  background: linear-gradient(to bottom, #3182ce, #2c5282);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.d8-condition-recovery .recovery-assist {
  background: linear-gradient(to bottom, var(--d8-success), #38a169);
  color: white;
}

.d8-condition-recovery .recovery-assist:hover {
  background: linear-gradient(to bottom, #38a169, #2f855a);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* Condition Save Cards */
.d8-condition-save {
  padding: 12px;
  border: 2px solid var(--d8-warning);
  border-radius: 5px;
  background: #fffaf0;
}

.d8-condition-save h3 {
  margin: 0 0 10px 0;
  color: var(--d8-warning);
  font-size: 16px;
  text-transform: uppercase;
}

.d8-condition-save p {
  margin: 10px 0;
  font-size: 14px;
  color: var(--d8-text);
}

.d8-condition-save button {
  width: 100%;
  padding: 10px 15px;
  background: linear-gradient(to bottom, var(--d8-warning), #dd6b20);
  color: white;
  border: none;
  border-radius: 4px;
  font-weight: bold;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 10px;
}

.d8-condition-save button:hover {
  background: linear-gradient(to bottom, #dd6b20, #c05621);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* Condition List in Character Sheet */
.legends .conditions-section {
  margin-bottom: 15px;
}

.legends .conditions-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.legends .condition-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 10px;
  background: #fff8dc;
  border-radius: 4px;
  border: 1px solid var(--d8-warning);
  border-left: 4px solid var(--d8-warning);
}

.legends .condition-item .condition-icon {
  width: 24px;
  height: 24px;
  border-radius: 3px;
}

.legends .condition-item .condition-name {
  flex: 1;
  font-weight: 600;
  font-size: 13px;
  color: var(--d8-text);
}

.legends .condition-item .condition-remove {
  padding: 4px 8px;
  background: var(--d8-danger);
  color: white;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-size: 11px;
  transition: all 0.2s;
}

.legends .condition-item .condition-remove:hover {
  background: #c53030;
  transform: translateY(-1px);
}

/* -------------------------------------------- */
/*  Inline Roll Enrichers                       */
/* -------------------------------------------- */

a.legends-roll-link {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 1px 6px;
  border-radius: 3px;
  background: var(--d8-info, #4299e1);
  color: #fff;
  font-weight: 600;
  font-size: 0.9em;
  text-decoration: none;
  cursor: pointer;
  white-space: nowrap;
  transition: background 0.15s, box-shadow 0.15s;
}

a.legends-roll-link:hover {
  background: #2b6cb0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
  text-decoration: none;
  color: #fff;
}

a.legends-roll-link i {
  font-size: 0.85em;
}

span.legends-damage-tag {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 1px 5px;
  border-radius: 3px;
  background: var(--d8-danger, #f56565);
  color: #fff;
  font-weight: 600;
  font-size: 0.9em;
  white-space: nowrap;
}

span.legends-damage-tag i {
  font-size: 0.85em;
}

/* ========================================
   MAGICAL TRAIT SETUP
   ======================================== */

.magical-trait-section {
  margin-bottom: 20px;
  padding: 15px;
  border: 2px solid var(--d8-border);
  border-radius: 8px;
  background: var(--d8-bg-light);
}

.magical-trait-section h3 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 1.3em;
  color: var(--d8-accent);
  border-bottom: 2px solid var(--d8-gold);
  padding-bottom: 8px;
}

.magic-setup-required {
  text-align: center;
  padding: 20px;
}

.setup-info h4 {
  color: var(--d8-gold);
  font-size: 1.2em;
  margin-bottom: 15px;
}

.trait-preview {
  background: white;
  padding: 12px;
  border-radius: 6px;
  margin: 15px 0;
  border-left: 4px solid var(--d8-gold);
}

.trait-preview .trait-name {
  font-weight: bold;
  color: var(--d8-accent);
  font-size: 1.1em;
}

.modifier-badge {
  display: inline-block;
  padding: 8px 15px;
  margin: 8px;
  border-radius: 6px;
  font-size: 0.95em;
}

.modifier-badge.gifted {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.modifier-badge.balanced {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  color: white;
}

.setup-instructions {
  margin: 15px 0;
  color: var(--d8-secondary);
  font-size: 0.95em;
  line-height: 1.6;
}

.setup-magical-traits-btn {
  padding: 12px 24px;
  font-size: 1.1em;
  font-weight: bold;
  background: linear-gradient(135deg, var(--d8-gold) 0%, #b8860b 100%);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.setup-magical-traits-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.setup-magical-traits-btn i {
  margin-right: 8px;
}

.magic-stats-display {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.energy-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 15px;
  padding: 8px 0;
  border-bottom: 2px solid var(--d8-border);
}

.energy-header h4 {
  margin: 0;
  flex: 1;
}

.magic-stats-inline {
  display: flex;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
}

.casting-stat-inline {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9em;
}

.casting-stat-inline label {
  font-weight: bold;
  color: var(--d8-accent);
}

.channel-uses {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.9em;
}

.channel-uses label {
  font-weight: bold;
  color: var(--d8-accent);
}

.uses-input {
  width: 40px !important;
  text-align: center;
  padding: 2px 4px !important;
  border: 1px solid var(--d8-border) !important;
  border-radius: 3px !important;
  background: #fff !important;
  font-size: 0.9em;
}

.max-value {
  font-weight: bold;
  color: var(--d8-secondary);
}

.casting-stat {
  font-size: 1.2em;
  color: var(--d8-gold);
  font-weight: bold;
}

.potentials-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 10px;
  margin-top: 10px;
}

.potential-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
  background: white;
  border-radius: 6px;
  border: 2px solid var(--d8-border);
}

.potential-item label {
  font-size: 0.85em;
  color: var(--d8-secondary);
  margin-bottom: 5px;
}

.potential-value {
  font-size: 1.5em;
  font-weight: bold;
  color: var(--d8-accent);
}

.mastery-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin-top: 10px;
}

.mastery-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  background: white;
  border-radius: 6px;
  border: 1px solid var(--d8-border);
}

.mastery-item label {
  font-size: 0.9em;
  color: var(--d8-secondary);
  font-weight: 600;
}

.mastery-input {
  width: 60px;
  text-align: center;
  font-weight: bold;
  padding: 4px;
  border: 1px solid var(--d8-border);
  border-radius: 4px;
}

/* Combined Energy Potentials/Mastery Grid */
.energy-potentials-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 10px;
  margin-top: 10px;
  max-width: 100%;
}

.energy-row {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 10px 8px;
  background: white;
  border-radius: 6px;
  border: 2px solid var(--d8-border);
  min-width: 0;
}

.energy-label {
  font-size: 0.9em;
  color: var(--d8-secondary);
  font-weight: 600;
  text-align: center;
  margin-bottom: 6px;
  white-space: nowrap;
}

.energy-values {
  display: flex;
  align-items: center;
  gap: 6px;
  justify-content: center;
}

.energy-values .energy-input {
  width: 45px !important;
  text-align: center !important;
  font-weight: bold;
  padding: 4px 2px !important;
  border: 1px solid var(--d8-border) !important;
  border-radius: 3px !important;
  background: #fff !important;
  font-size: 1em;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
}

.energy-values .energy-input:focus {
  outline: none !important;
  border-color: var(--d8-info) !important;
  box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.1) !important;
}

.energy-values .separator {
  font-size: 1.1em;
  color: var(--d8-border);
  font-weight: bold;
  margin: 0 2px;
}

/* ========================================
   WEAVE LIST COLLAPSIBLE SYSTEM
   Enhanced with new collapsible functionality
   ======================================== */

/* Weave List Container */
.legends .weave-list .item-collapsible {
  border: 1px solid var(--d8-border);
  border-top: none;
  background: white;
}

.legends .weave-list .item-collapsible:first-child {
  border-top: 1px solid var(--d8-border);
}

/* Weave Item Header - More specific */
.legends .weave-list .item-header {
  display: flex !important;
  align-items: center;
  padding: 0.75rem 0.5rem;
  gap: 0.75rem;
  cursor: pointer;
  transition: all 0.15s ease;
  user-select: none; /* Prevent text selection when clicking */
}

/* Individual Item Header Children */
.legends .weave-list .item-header > .item-caret {
  flex: 0 0 auto !important;
  width: 12px;
}

.legends .weave-list .item-header > .item-image {
  flex: 0 0 24px !important;
}

.legends .weave-list .item-header > .weave-info {
  flex: 1 !important;
  min-width: 0;
}

.legends .weave-list .item-header:hover {
  background: rgba(74, 85, 104, 0.05);
}

.legends .weave-list .item-header:hover .item-name-clickable {
  color: var(--d8-primary);
}

.legends .weave-list .item-collapsible.expanded .item-header {
  background: rgba(74, 85, 104, 0.08);
  border-bottom: 1px solid var(--d8-border);
}

/* Individual Energy Display Elements in Weave List */
.legends .weave-list .item-header > .energy-display {
  flex: 0 0 80px !important;
  text-align: center;
  font-size: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
  color: var(--d8-text);
}

.legends .weave-list .item-header > .item-detail {
  flex: 0 0 60px !important;
  text-align: center;
  font-size: 12px;
  font-weight: 600;
  color: #2d3748 !important; /* Dark gray - override everything */
  background: transparent !important;
}

.legends .weave-list .item-header > .weave-total-cost {
  flex: 0 0 60px !important;
  text-align: center;
  font-size: 14px !important;
  font-weight: 700 !important;
  color: #2d3748 !important;
  background: transparent !important;
}

.legends .weave-list .item-header > .item-controls {
  flex: 0 0 120px !important;
}

.legends .weave-list .item-name-clickable {
  font-weight: 600;
  font-size: 0.95rem;
  color: var(--d8-text);
  text-decoration: none;
  transition: color 0.2s ease;
}

.legends .weave-list .item-name-clickable:hover {
  color: var(--d8-primary);
}

/* Weave Metadata */
.legends .weave-list .weave-meta {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.legends .weave-list .weave-type {
  background: var(--d8-primary);
  color: white;
  padding: 0.125rem 0.5rem;
  border-radius: 10px;
  font-size: 0.65rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.025rem;
}

.legends .weave-list .weave-cost {
  background: rgba(201, 153, 99, 0.2);
  color: var(--d8-gold);
  padding: 0.125rem 0.5rem;
  border-radius: 10px;
  font-size: 0.65rem;
  font-weight: 600;
}

/* Energy Display in Quick Stats */
.legends .weave-list .item-quick-stats {
  display: flex;
  gap: 1rem;
  align-items: center;
  margin-right: 1rem;
}

.legends .weave-list .energy-display {
  display: flex;
  align-items: center;
  gap: 0.25rem;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--d8-secondary);
  min-width: 2rem;
  text-align: center;
}

.legends .weave-list .energy-display img {
  flex-shrink: 0;
  border-radius: 2px;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
}

.legends .weave-list .energy-total {
  background: rgba(74, 85, 104, 0.1);
  color: var(--d8-primary);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-weight: 700;
  font-size: 0.8rem;
  min-width: 2rem;
  text-align: center;
}

/* Weave List Item Controls */
.legends .weave-list .item-controls {
  display: flex;
  gap: 0.25rem;
  flex-shrink: 0;
}

.legends .weave-list .item-control {
  padding: 0.375rem;
  border-radius: 4px;
  transition: all 0.2s ease;
  font-size: 0.8rem;
}

.legends .weave-list .item-control[data-action="itemRoll"] {
  background: rgba(72, 187, 120, 0.1);
  color: var(--d8-success);
}

.legends .weave-list .item-control[data-action="itemRoll"]:hover {
  background: var(--d8-success);
  color: white;
  transform: translateY(-1px);
}

/* Responsive Weave List */
@media (max-width: 768px) {
  .legends .weave-list .item-header {
    flex-wrap: wrap;
    gap: 0.5rem;
    padding: 1rem 0.5rem;
  }
  
  .legends .weave-list .item-quick-stats {
    order: 3;
    flex: 1 1 100%;
    justify-content: space-around;
    margin: 0.5rem 0 0 0;
    padding: 0.5rem;
    background: rgba(247, 250, 252, 0.8);
    border-radius: 4px;
  }
}

/* ========================================
   CHAT CARD STYLING  
   ======================================== */

.legends-item-card {
  border: 2px solid var(--d8-border);
  border-radius: 8px;
  overflow: hidden;
  background: white;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.legends-item-card .card-header {
  background: var(--d8-accent);
  color: white;
  padding: 12px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.legends-item-card .card-header img {
  width: 32px;
  height: 32px;
  border-radius: 4px;
}

.legends-item-card .card-header h3 {
  margin: 0;
  font-size: 1.2em;
  font-weight: 600;
}

.legends-item-card .card-content {
  padding: 12px;
}

.legends-item-card .weave-details {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-bottom: 12px;
}

.legends-item-card .energy-line,
.legends-item-card .weave-property {
  display: flex;
  gap: 8px;
  align-items: flex-start;
  font-size: 0.95em;
  line-height: 1.4;
}

.legends-item-card .energy-line strong,
.legends-item-card .weave-property strong {
  min-width: 120px;
  color: var(--d8-accent);
  font-weight: 600;
  flex-shrink: 0;
}

.legends-item-card .item-description {
  margin-top: 12px;
  padding: 10px;
  background: rgba(0,0,0,0.05);
  border-radius: 6px;
  border-left: 4px solid var(--d8-info);
  font-size: 0.9em;
  line-height: 1.5;
}

.channel-divinity-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  background: white;
  border-radius: 6px;
  border-left: 4px solid var(--d8-info);
  margin-top: 10px;
}

.channel-divinity-row label {
  font-weight: bold;
  color: var(--d8-accent);
}

/* Dice Roll Success/Failure Indicators */
.success-indicator {
  color: #28a745;
  font-weight: bold;
  font-size: 0.9em;
}

.failure-indicator {
  color: #dc3545;
  font-weight: bold;
  font-size: 0.9em;
}

.natural-one {
  color: #28a745;
  font-weight: bold;
}

.natural-eight {
  color: #dc3545;
  font-weight: bold;
}

