# Legends Collapsible Item System - Implementation Guide\n\nThis system provides a universal, robust collapsible item interface inspired by PF2E's best practices but optimized for the Legends system.\n\n## Quick Start\n\n### 1. Template Structure\n\nReplace your existing item `<li>` elements with this structure:\n\n```handlebars\n<li class=\"item-collapsible\" data-item-id=\"{{item._id}}\">\n  <!-- Item Header (always visible, clickable) -->\n  <div class=\"item-header\" data-action=\"expandItem\">\n    <i class=\"item-caret fas fa-caret-right\"></i>\n    <div class=\"item-image\">\n      <img src=\"{{item.img}}\" title=\"{{item.name}}\" width=\"24\" height=\"24\"/>\n    </div>\n    <span class=\"item-name-clickable\">{{item.name}}</span>\n    \n    <!-- Optional: Quick stats or metadata -->\n    <div class=\"item-quick-stats\">\n      <!-- Item-type specific info -->\n    </div>\n    \n    <!-- Your existing item controls -->\n    <div class=\"item-controls\">\n      <!-- buttons here -->\n    </div>\n  </div>\n  \n  <!-- Collapsible content (starts empty, populated by JavaScript) -->\n  <div class=\"item-summary\">\n    <!-- Content generated automatically based on item type -->\n  </div>\n</li>\n```\n\n### 2. Required Classes\n\n- **`.item-collapsible`** - Container with `data-item-id`\n- **`.item-header`** - Clickable header with `data-action=\"expandItem\"`  \n- **`.item-caret`** - FontAwesome caret icon (starts as `fa-caret-right`)\n- **`.item-name-clickable`** - The item name\n- **`.item-summary`** - Container for collapsible content (starts empty)\n\n### 3. JavaScript Integration\n\nThe system is already integrated into your `D8CharacterSheet` class. The `expandItem` action handler:\n\n- Detects clicks on `.item-header` elements\n- Loads content dynamically on first expansion\n- Generates appropriate content based on item type\n- Handles smooth animations and state management\n\n## Item Type Support\n\nThe system automatically generates appropriate content for:\n\n### Weapons\n- Attack bonus, damage, range, weight\n- Weapon traits/properties as tags\n\n### Armor  \n- Damage reduction (DR) values\n- Weight, cost\n- Armor properties as tags\n\n### Weaves\n- Weave type, action cost, range, duration\n- Energy costs breakdown\n\n### Feats\n- Prerequisites, usage type\n- Keywords as tags\n\n### Traits/Flaws\n- Category, tier information\n\n### Actions\n- Action type, cost\n- Keywords as tags\n\n### Generic Items\n- Weight, cost\n- Basic item information\n\n## Advanced Customization\n\n### Custom Summary Content\n\nTo add custom content for specific item types, modify the `_generateXXXSummary` methods in `character-sheet.mjs`:\n\n```javascript\nstatic _generateWeaponSummary(system) {\n  let html = '';\n  \n  // Add your custom content here\n  if (system.customProperty) {\n    html += `<div class=\"detail-row\">\n      <span class=\"detail-label\">Custom:</span>\n      <span class=\"detail-value\">${system.customProperty}</span>\n    </div>`;\n  }\n  \n  return html;\n}\n```\n\n### Custom Quick Stats\n\nIn your templates, customize the `.item-quick-stats` div for each item type:\n\n```handlebars\n<!-- For weapons -->\n<div class=\"item-quick-stats\">\n  <span class=\"item-attack\">+{{item.system.attack.bonus}}</span>\n  <span class=\"item-damage\">{{item.system.damage.base}} {{item.system.damage.type}}</span>\n</div>\n\n<!-- For armor -->\n<div class=\"item-quick-stats\">\n  <span class=\"item-dr\">DR: {{item.system.dr.slashing}}/{{item.system.dr.piercing}}/{{item.system.dr.bludgeoning}}</span>\n</div>\n```\n\n### CSS Customization\n\nThe system uses CSS custom properties for easy theming:\n\n```css\n:root {\n  --d8-primary: #4a5568;     /* Main theme color */\n  --d8-accent: #2d3748;      /* Accent color */\n  --d8-border: #cbd5e0;      /* Border color */\n  --d8-secondary: #718096;   /* Secondary text */\n}\n```\n\n## Migration from Existing System\n\n### Template Updates\n\n1. **Change item containers:**\n   - `<li class=\"item flexrow\">` → `<li class=\"item-collapsible\">`\n   - Add `data-item-id=\"{{item._id}}\"`\n\n2. **Wrap content in header:**\n   ```handlebars\n   <div class=\"item-header\" data-action=\"expandItem\">\n     <!-- Your existing item content -->\n   </div>\n   ```\n\n3. **Add caret and summary:**\n   ```handlebars\n   <i class=\"item-caret fas fa-caret-right\"></i>\n   <!-- ... other content ... -->\n   <div class=\"item-summary\"></div>\n   ```\n\n4. **Update item name:**\n   - `<h4 class=\"item-name\">` → `<span class=\"item-name-clickable\">`\n\n### Backward Compatibility\n\nThe system maintains backward compatibility:\n- Existing `.item` elements still work normally\n- Only `.item-collapsible` elements get the new functionality\n- You can migrate incrementally\n\n## Performance Notes\n\n### Lazy Loading\n- Content is only generated when items are first expanded\n- No performance impact on sheet rendering\n- Efficient memory usage for large item lists\n\n### Smooth Animations\n- CSS transitions handle expand/collapse animations\n- No JavaScript animation overhead\n- 60fps performance on modern browsers\n\n## Troubleshooting\n\n### Common Issues\n\n1. **Click not working:**\n   - Ensure `data-action=\"expandItem\"` is on `.item-header`\n   - Check that container has `.item-collapsible` class\n   - Verify `data-item-id` is set correctly\n\n2. **Content not loading:**\n   - Check browser console for errors\n   - Ensure item exists in `this.actor.items`\n   - Verify item type is supported\n\n3. **Styling issues:**\n   - Check CSS custom properties are defined\n   - Ensure proper class hierarchy\n   - Verify no conflicting styles\n\n### Browser Support\n- Modern browsers (Chrome 60+, Firefox 60+, Safari 12+)\n- Uses standard CSS transitions and flexbox\n- Degrades gracefully on older browsers\n\n## Example Implementation\n\nSee `COLLAPSIBLE_ITEM_EXAMPLES.hbs` for complete template examples for all item types.\n\n---\n\n**This system provides:**\n✅ Consistent UX across all item types  \n✅ Smooth animations and transitions  \n✅ Lazy loading for performance  \n✅ Mobile-responsive design  \n✅ Easy customization and theming  \n✅ Backward compatibility  \n✅ Minimal JavaScript overhead\n